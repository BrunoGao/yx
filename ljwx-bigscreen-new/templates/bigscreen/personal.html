<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="utf-8">

    <title>æ™ºèƒ½ç©¿æˆ´ç®¡ç†æ¼”ç¤ºå¤§å±</title>

 
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/personal-index.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/profile-button.css') }}">
    <style type="text/css">
        /* ä¸»å±é£æ ¼ç»Ÿä¸€ */
        body {
            background: linear-gradient(135deg, #031921, #052b3a) !important;
            color: #ffffff;
        }

        .content {
            background: transparent;
        }

        /* é¢æ¿ç»Ÿä¸€é£æ ¼ */
        .air, .tem-hum, .wind, .rainfall {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 255, 157, 0.05));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 20px rgba(0, 21, 41, 0.3);
            margin-bottom: 15px;
        }

        /* æ ‡é¢˜ç»Ÿä¸€é£æ ¼ */
        .title, .air-title {
            color: #00e4ff !important;
            text-shadow: 0 0 10px rgba(0, 228, 255, 0.5);
            background: linear-gradient(90deg, transparent, rgba(0, 228, 255, 0.1), transparent) !important;
            border-bottom: 1px solid rgba(0, 228, 255, 0.3);
        }

        /* æ•°å€¼æ˜¾ç¤ºç»Ÿä¸€é£æ ¼ */
        .profile-button a {
            color: #00e4ff !important;
            text-shadow: 0 0 5px rgba(0, 228, 255, 0.8);
            background: rgba(0, 21, 41, 0.8);
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            text-decoration: none;
            font-size: 12px;
        }

        .profile-button a:hover {
            color: #00ff9d !important;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
        }

        /* ä¸“ä¸šåŠ¨ç”»æ•ˆæœ */
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes flow {
            0% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            100% { transform: translateX(-10px); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255,170,0,0.5); }
            50% { box-shadow: 0 0 20px rgba(255,170,0,1); }
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ä»ªè¡¨ç›˜å®¹å™¨æ ·å¼ */
        .gauge-container {
            position: relative;
            width: 100%;
            height: 180px;
            background: radial-gradient(circle, rgba(0,21,41,0.9), rgba(0,255,157,0.05));
            border-radius: 50%;
            border: 2px solid rgba(0,228,255,0.3);
            overflow: hidden;
        }

        .gauge-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: conic-gradient(from 0deg, rgba(0,228,255,0.2), transparent 180deg);
            animation: rotate 4s linear infinite;
        }

        .tem-hum-chart {
            width: 100%;
            height: 100%;
            position: absolute;
            z-index: 5;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼å’ŒåŠ¨ç”» */
        .breathe-zct{ 
            position:relative; width:20px; height:20px; top:2px;float:left;  
            border:1px solid #00e4ff; border-radius:20px; color:#fff; font-size:10px; 
            cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.3); overflow:hidden; 
            background-image: -webkit-gradient(linear, left top, left bottom, from(#00e4ff), to(#00e4ff));
            background-image: -moz-linear-gradient(#00e4ff,#00e4ff);
        }
        
        .breathe-yct{ 
            position:relative; width:20px; height:20px; top:2px;float:left;   
            border:1px solid #ff4444; border-radius:20px; color:#fff; font-size:20px;  
            cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.3); overflow:hidden; 
            background-image: -webkit-gradient(linear, left top, left bottom, from(#ff4444), to(#ff4444));
            background-image: -moz-linear-gradient(#ff4444,#ff4444);
        }
        
        .breathe-zc{ 
            position:relative; width:20px; height:20px; margin:10px auto; line-height:40px; 
            border:1px solid #00e4ff; border-radius:10px; color:#fff; font-size:20px; 
            text-align:center; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.3); overflow:hidden; 
            background-image: -webkit-gradient(linear, left top, left bottom, from(#00e4ff), to(#00e4ff));
            background-image: -moz-linear-gradient(#00e4ff,#00e4ff);
            -webkit-animation-timing-function: ease-in-out;
            -webkit-animation-name: breathe;
            -webkit-animation-duration: 500ms;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-direction: alternate;
            animation:ease-in-out breathe 500ms infinite alternate; 
        }

        .breathe-yc{ 
            position:relative; width:20px; height:20px; margin:10px auto; line-height:40px; 
            border:1px solid #ff4444; border-radius:10px; color:#fff; font-size:20px; 
            text-align:center; cursor:pointer; box-shadow:0 1px 2px rgba(0,0,0,.3); overflow:hidden; 
            background-image: -webkit-gradient(linear, left top, left bottom, from(#ff4444), to(#ff4444));
            background-image: -moz-linear-gradient(#ff4444,#ff4444);
            -webkit-animation-timing-function: ease-in-out;
            -webkit-animation-name: breathe-red;
            -webkit-animation-duration: 1000ms;
            -webkit-animation-iteration-count: infinite;
            -webkit-animation-direction: alternate;
            animation:ease-in-out breathe-red 500ms infinite alternate; 
        }

        @keyframes breathe{
            0% { opacity: .2; box-shadow:0 1px 2px rgba(255,255,255,0.1);}
            100% { opacity: 1; border:1px solid rgba(0,228,255,1); box-shadow:0 1px 30px rgba(0,228,255,1);}
        }
        @-webkit-keyframes breathe {
            0% { opacity: .2; box-shadow:0 1px 2px rgba(255,255,255,0.1);}
            100% { opacity: 1; border:1px solid rgba(0,228,255,1); box-shadow:0 1px 30px rgba(0,228,255,1);}
        }

        @keyframes breathe-red{
            0% { opacity: .2; box-shadow:0 1px 2px rgba(255,255,255,0.1);}
            100% { opacity: 1; border:1px solid rgba(255,68,68,1); box-shadow:0 1px 30px rgba(255,68,68,1);}
        }
        @-webkit-keyframes breathe-red {
            0% { opacity: .2; box-shadow:0 1px 2px rgba(255,255,255,0.1);}
            100% { opacity: 1; border:1px solid rgba(255,68,68,1); box-shadow:0 1px 30px rgba(255,68,68,1);}
        }

        /* è¡¨æ ¼ç»Ÿä¸€é£æ ¼ */
        .message-table, .alert-table {
            background: rgba(0, 21, 41, 0.9);
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(8px);
        }

        .message-table th, .alert-table th,
        .message-table td, .alert-table td {
            border: 1px solid rgba(0, 228, 255, 0.2);
            color: #ffffff;
        }

        .message-table th, .alert-table th {
            background: rgba(0, 228, 255, 0.2);
            color: #00e4ff;
        }

        /* ä»ªè¡¨ç›˜èƒŒæ™¯ */
        .tem-hum-chart {
            background: rgba(0, 21, 41, 0.3);
            border-radius: 50%;
        }

        /* åœ°å›¾åŒºåŸŸé£æ ¼ */
        .chinaMap {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 255, 157, 0.05));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(8px);
        }

        .headTitle {
            color: #00e4ff !important;
            text-shadow: 0 0 20px rgba(0, 228, 255, 0.8);
            background: linear-gradient(90deg, transparent, rgba(0, 228, 255, 0.1), transparent);
        }

        /* ä¸ªäººç»Ÿè®¡é¢æ¿æ ·å¼ */
        .personal-stats {
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 255, 157, 0.05));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 20px rgba(0, 21, 41, 0.3);
            margin-bottom: 15px;
            padding: 15px;
            height: 20%; /* é™åˆ¶ç¬¬ä¸€ä¸ªpanelé«˜åº¦ */
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px; /* è¿›ä¸€æ­¥ç¼©å° */
            padding-bottom: 4px; /* ç¼©å°å¡«å…… */
            border-bottom: 1px solid rgba(0, 228, 255, 0.3);
        }

        .stats-title {
            color: #00e4ff;
            font-size: 16px; /* ä»14pxå¢åŠ åˆ°16px */
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 228, 255, 0.5);
        }

        .stats-date {
            color: #ccc;
            font-size: 12px; /* ä»10pxå¢åŠ åˆ°12px */
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px; /* ç¼©å°å¡ç‰‡ä¹‹é—´é—´è· */
            margin-bottom: 6px; /* ç¼©å°åº•éƒ¨é—´è· */
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(0, 51, 102, 0.3), rgba(0, 255, 157, 0.1));
            border: 1px solid rgba(0, 228, 255, 0.2);
            border-radius: 4px;
            padding: 8px; /* ä»6pxå¢åŠ åˆ°8px */
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 204, 255, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px; /* å‡å°‘å®½åº¦ */
            height: 100%;
            background: linear-gradient(to bottom, #00e4ff, #00ff9d);
        }

        .stat-icon {
            width: 18px; /* ä»16pxå¢åŠ åˆ°18px */
            height: 18px;
            background: rgba(0, 228, 255, 0.2);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px; /* ä»4pxå¢åŠ åˆ°5px */
            font-size: 14px; /* ä»12pxå¢åŠ åˆ°14px */
        }

        .stat-value {
            font-size: 18px; /* ä»16pxå¢åŠ åˆ°18px */
            font-weight: bold;
            color: #00e4ff;
            margin-bottom: 3px; /* ä»2pxå¢åŠ åˆ°3px */
            text-shadow: 0 0 10px rgba(0, 228, 255, 0.5);
        }

        .stat-label {
            font-size: 11px; /* ä»9pxå¢åŠ åˆ°11px */
            color: #ccc;
            margin-bottom: 4px; /* ä»3pxå¢åŠ åˆ°4px */
        }

        .stat-trend {
            font-size: 10px; /* ä»8pxå¢åŠ åˆ°10px */
            font-weight: bold;
        }

        .trend-up {
            color: #00ff88;
        }

        .trend-down {
            color: #ff4757;
        }

        .system-status {
            background: linear-gradient(135deg, rgba(0, 51, 102, 0.3), rgba(0, 255, 157, 0.1));
            border: 1px solid rgba(0, 228, 255, 0.2);
            border-radius: 4px;
            padding: 8px; /* ä»6pxå¢åŠ åˆ°8px */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .system-status-left {
            display: flex;
            align-items: center;
            gap: 8px; /* ä»6pxå¢åŠ åˆ°8px */
        }

        .status-indicator {
            width: 10px; /* ä»8pxå¢åŠ åˆ°10px */
            height: 10px;
            border-radius: 50%;
            background: #00ff88;
            animation: pulse 2s infinite;
        }

        .status-text {
            color: #fff;
            font-size: 13px; /* ä»11pxå¢åŠ åˆ°13px */
            font-weight: bold;
        }

        .status-score {
            font-size: 22px; /* ä»20pxå¢åŠ åˆ°22px */
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        //#å‘Šè­¦å¤„ç†å¼¹çª—åŠ¨ç”»æ•ˆæœ
        @keyframes alertFadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        @keyframes overlayFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .custom-alert-overlay {
            animation: overlayFadeIn 0.3s ease;
        }

        .custom-alert {
            animation: alertFadeIn 0.3s ease;
        }

        //#å‘Šè­¦å¤„ç†æŒ‰é’®ä¼˜åŒ–æ ·å¼ - ç»Ÿä¸€å­—ä½“å¤§å°
        .alert-process-btn {
            background: linear-gradient(135deg, rgba(0, 228, 255, 0.3), rgba(0, 180, 255, 0.5)) !important;
            border: 1px solid rgba(0, 228, 255, 0.4) !important;
            color: #00e4ff !important;
            padding: 4px 8px !important;
            border-radius: 4px !important;
            font-size: 11px !important; /* ç¼©å°å­—ä½“é¿å…ä¸å…¶ä»–åˆ—ä¸åŒ¹é… */
            font-weight: normal !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            text-shadow: 0 0 8px rgba(0, 228, 255, 0.5) !important;
            box-shadow: 0 2px 8px rgba(0, 228, 255, 0.2) !important;
        }

        .alert-process-btn:hover {
            background: linear-gradient(135deg, rgba(0, 228, 255, 0.5), rgba(0, 180, 255, 0.7)) !important;
            transform: translateY(-2px) scale(1.05) !important;
            box-shadow: 0 4px 15px rgba(0, 228, 255, 0.4) !important;
        }

        .alert-process-btn:active {
            transform: translateY(0) scale(1) !important;
            box-shadow: 0 2px 8px rgba(0, 228, 255, 0.2) !important;
        }

        /* ä¼˜åŒ–æ¶ˆæ¯é¢æ¿ - æ‰©å¤§æ˜¾ç¤ºåŒºåŸŸ */
        .message-panel-pro {
            height: 280px; /* å¢å¤§é«˜åº¦æä¾›æ›´å¤šæ˜¾ç¤ºç©ºé—´ */
            max-height: 280px;
            background: linear-gradient(135deg, rgba(0, 21, 41, 0.9), rgba(0, 255, 157, 0.05));
            border: 1px solid rgba(0, 228, 255, 0.3);
            border-radius: 8px;
            backdrop-filter: blur(8px);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            margin-bottom: 15px;
        }

        .message-panel-pro:hover {
            border-color: rgba(0, 228, 255, 0.6);
            box-shadow: 0 4px 20px rgba(0, 228, 255, 0.2);
            transform: translateY(-2px);
        }

        .message-header-pro {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(0, 228, 255, 0.1);
            border-bottom: 1px solid rgba(0, 228, 255, 0.2);
            height: 42px; /* å›ºå®šæ ‡é¢˜é«˜åº¦ */
            box-sizing: border-box;
            flex-shrink: 0;
        }

        .message-title-pro {
            color: #00e4ff;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 228, 255, 0.5);
        }

        .message-count-pro {
            background: linear-gradient(45deg, #ff4757, #ff6b7d);
            color: #fff;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(255, 71, 87, 0.3);
            min-width: 20px;
            text-align: center;
            animation: pulse-count 2s infinite;
        }

        .message-scroll-container {
            height: 209px; /* å¢å¤§æ»šåŠ¨åŒºåŸŸï¼š280px - 42px - 29px = 209px */
            overflow: hidden;
            position: relative;
            padding: 0;
        }

        .message-scroll-content {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            transition: transform 0.8s ease-in-out; /* å¹³æ»‘æ»šåŠ¨æ•ˆæœ */
        }

        .message-scroll-content.scrolling {
            animation: scrollMessages3 linear infinite;
        }

        .message-item-pro {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 228, 255, 0.1);
            transition: background 0.3s ease;
            height: 70px; /* å¢å¤§æ¯æ¡æ¶ˆæ¯é«˜åº¦ï¼Œæä¾›æ›´å¤šå†…å®¹ç©ºé—´ */
            min-height: 70px;
            max-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* æ”¹ä¸ºspace-betweenç¡®ä¿å¸ƒå±€åˆç† */
            box-sizing: border-box;
            position: relative;
        }

        .message-item-pro:hover {
            background: rgba(0, 228, 255, 0.05);
        }

        .message-item-pro:last-child {
            border-bottom: none;
        }

        .message-content-pro {
            color: #ffffff;
            font-size: 13px; /* è¿›ä¸€æ­¥å¢å¤§å­—ä½“æå‡å¯è¯»æ€§ */
            line-height: 1.5;
            word-wrap: break-word;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* å¢åŠ è‡³3è¡Œå†…å®¹æ˜¾ç¤º */
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            max-height: 42px; /* å¢å¤§å†…å®¹åŒºåŸŸé«˜åº¦ï¼Œæ”¯æŒ3è¡Œæ–‡æœ¬ */
            flex: 1; /* ä½¿ç”¨flexå¸ƒå±€è‡ªåŠ¨å ç”¨å¯ç”¨ç©ºé—´ */
        }

        .message-meta-pro {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 18px; /* å¢å¤§åº•éƒ¨å…ƒä¿¡æ¯é«˜åº¦ */
            flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
        }

        .message-type-pro {
            font-size: 9px; /* ä¸æ—¶é—´å­—ä½“ä¿æŒä¸€è‡´ */
            padding: 2px 5px; /* ç¨å¾®å‡å°å†…è¾¹è· */
            border-radius: 4px;
            color: #fff;
            font-weight: bold;
            white-space: nowrap; /* ç¡®ä¿ç±»å‹æ ‡ç­¾ä¸æ¢è¡Œ */
        }

        .message-type-pro.announcement { background: #4caf50; }
        .message-type-pro.notification { background: #2196f3; }
        .message-type-pro.warning { background: #ff9800; }
        .message-type-pro.task { background: #9c27b0; }
        .message-type-pro.job { background: #00bcd4; }

        .message-time-pro {
            color: rgba(255, 255, 255, 0.6);
            font-size: 9px; /* å‡å°å­—ä½“é€‚åº”å®Œæ•´æ—¥æœŸæ—¶é—´æ˜¾ç¤º */
            white-space: nowrap; /* ç¡®ä¿æ—¶é—´ä¸æ¢è¡Œ */
        }

        .message-click-hint {
            position: absolute;
            bottom: 8px;
            right: 12px;
            color: rgba(0, 228, 255, 0.6);
            font-size: 10px; /* å¢å¤§å­—ä½“ */
            animation: blink 2s infinite;
            z-index: 10;
            background: rgba(0, 21, 41, 0.8);
            padding: 3px 6px; /* å¢å¤§å†…è¾¹è· */
            border-radius: 4px;
        }

        @keyframes scrollMessages3 {
            0% { transform: translateY(0); }
            20% { transform: translateY(0); }
            25% { transform: translateY(-70px); }
            45% { transform: translateY(-70px); }
            50% { transform: translateY(-140px); }
            70% { transform: translateY(-140px); }
            75% { transform: translateY(-210px); }
            95% { transform: translateY(-210px); }
            100% { transform: translateY(-280px); }
        }

        @keyframes pulse-count {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        //#é¢æ¿ç‚¹å‡»æ‚¬åœæ•ˆæœ
        .alert-panel:hover, .device-status:hover, .health-dashboard:hover, .message-panel-pro:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 228, 255, 0.3) !important;
            border-color: rgba(0, 228, 255, 0.6) !important;
            transition: all 0.3s ease !important;
        }

        .alert-panel:active, .device-status:active, .health-dashboard:active, .message-panel-pro:active {
            transform: translateY(0px);
            box-shadow: 0 4px 15px rgba(0, 228, 255, 0.2) !important;
        }
    </style>
 
</head>


<body>
    <div class="content">
        <div class="left">
            <!--ä¸ªäººç»Ÿè®¡æ¦‚è§ˆ-->
            <div class="personal-stats">
                <div class="stats-header">
                    <div class="stats-title">ğŸ“Š å®æ—¶ç»Ÿè®¡</div>
                    <div class="stats-date" id="personalStatsDate"></div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-value" id="personalHealthData">0</div>
                        <div class="stat-label">å¥åº·æ•°æ®</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">âš ï¸</div>
                        <div class="stat-value" id="personalAlerts">0</div>
                        <div class="stat-label">å¾…å¤„ç†å‘Šè­¦</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“±</div>
                        <div class="stat-value" id="personalDevice">1</div>
                        <div class="stat-label">è®¾å¤‡çŠ¶æ€</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’¬</div>
                        <div class="stat-value" id="personalMessages">0</div>
                        <div class="stat-label">æœªè¯»æ¶ˆæ¯</div>
                    </div>
                </div>
                
                <div class="system-status">
                    <div class="system-status-left">
                        <div class="status-indicator"></div>
                        <div class="status-text">å¥åº·çŠ¶æ€</div>
                    </div>
                    <div class="status-score" id="personalHealthScore">95</div>
                </div>
            </div>
            <!--ä¸ªäººç»Ÿè®¡æ¦‚è§ˆ end-->
            
            <!--å®æ—¶ä½“å¾æ•°æ®-->
            <div class="tem-hum">
                <div class="air-title title numfont" style="height: 8%; margin-bottom: 1%;">å®æ—¶ä½“å¾æ•°æ®</div>
                <!-- ç¬¬ä¸€è¡Œï¼šå¿ƒç‡å’Œè¡€æ°§ -->
                <div style="display: flex; height: 42%; margin-bottom: 2%;">
                    <div class="temperature" style="width: 50%; height: 100%; padding: 1%; position: relative;">
                        <div class="tem-hum-title numfont" style="height: 15%; font-size: 10px;">ğŸ’“ å®æ—¶å¿ƒç‡</div>
                        <div class="gauge-container" style="height: 70%; position: relative;">
                            <div class="tem-hum-chart" id="heartRateChart"></div>
                            <!-- æ•°å€¼å åŠ æ˜¾ç¤º -->
                            <div class="vital-value-overlay" id="heartRateValue" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #00ff88; font-size: 18px; font-weight: bold; text-shadow: 0 0 10px rgba(0,255,136,0.8); z-index: 10;">82</div>
                        </div>
                        <div class="heartRate-val" style="height: 12%;">
                            <button class="profile-button" id="heartRateStatus" style="background:linear-gradient(45deg,#ff4757,#ff6b6b);color:#fff;animation:heartbeat 1.5s infinite;font-size:11px;padding:3px;">82 bpm | æ­£å¸¸èŒƒå›´</button>
                        </div>
                    </div>
                    <div class="humidity" style="width: 50%; height: 100%; padding: 1%; position: relative;">
                        <div class="tem-hum-title numfont" style="height: 15%; font-size: 10px;">ğŸ©¸ å®æ—¶è¡€æ°§</div>   
                        <div class="gauge-container" style="height: 70%; position: relative;">
                            <div class="tem-hum-chart" id="bloodOxygenChart"></div>
                            <!-- æ•°å€¼å åŠ æ˜¾ç¤º -->
                            <div class="vital-value-overlay" id="bloodOxygenValue" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #00ccff; font-size: 18px; font-weight: bold; text-shadow: 0 0 10px rgba(0,204,255,0.8); z-index: 10;">98%</div>
                        </div>
                        <div class="bloodOxygen-val" style="height: 12%;">
                            <button class="profile-button" id="bloodOxygenStatus" style="background:linear-gradient(45deg,#00ccff,#00ff88);color:#fff;animation:pulse 2s infinite;font-size:11px;padding:3px;">98% | ä¼˜ç§€çŠ¶æ€</button>
                        </div>
                    </div>
                </div>
                <!-- ç¬¬äºŒè¡Œï¼šè¡€å‹å’Œä½“æ¸© -->
                <div style="display: flex; height: 42%;">
                    <div class="temperature" style="width: 50%; height: 100%; padding: 1%; position: relative;">
                        <div class="tem-hum-title numfont" style="height: 15%; font-size: 10px;">ğŸ’‰ å®æ—¶è¡€å‹</div>
                        <div class="gauge-container" style="height: 70%; position: relative;">
                            <div class="tem-hum-chart" id="pressureChart"></div>
                            <!-- æ•°å€¼å åŠ æ˜¾ç¤º -->
                            <div class="vital-value-overlay" id="pressureValue" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ff6b6b; font-size: 16px; font-weight: bold; text-shadow: 0 0 10px rgba(255,107,107,0.8); z-index: 10;">120/80</div>
                        </div>
                        <div class="pressure-val" style="height: 12%;">
                            <button class="profile-button" id="pressureStatus" style="background:linear-gradient(45deg,#ff6b6b,#4ecdc4);color:#fff;animation:flow 3s infinite;font-size:11px;padding:3px;">120/80 mmHg | ç†æƒ³è¡€å‹</button>
                        </div>
                    </div>
                    <div class="humidity" style="width: 50%; height: 100%; padding: 1%; position: relative;">
                        <div class="tem-hum-title numfont" style="height: 15%; font-size: 10px;">ğŸŒ¡ï¸ å®æ—¶ä½“æ¸©</div>   
                        <div class="gauge-container" style="height: 70%; position: relative;">
                            <div class="tem-hum-chart" id="temperatureChart"></div>
                            <!-- æ•°å€¼å åŠ æ˜¾ç¤º -->
                            <div class="vital-value-overlay" id="temperatureValue" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #ffaa00; font-size: 16px; font-weight: bold; text-shadow: 0 0 10px rgba(255,170,0,0.8); z-index: 10;">36.8Â°C</div>
                        </div>
                        <div class="temperature-val" style="height: 12%;">
                            <button class="profile-button" id="temperatureStatus" style="background:linear-gradient(45deg,#ffaa00,#ff9500);color:#fff;animation:glow 2.5s infinite;font-size:11px;padding:3px;">36.8Â°C | æ­£å¸¸ä½“æ¸©</button>
                        </div>
                    </div>
                </div>
            </div>
            <!--å®æ—¶ä½“å¾æ•°æ® end-->
            
            <!--å‘Šè­¦panel-->
            <div class="rainfall alert-panel" onclick="navigateToAlertView()" style="cursor: pointer;">
                <div class="air-title title numfont">å‘Šè­¦ä¿¡æ¯ <span style="float: right; color: rgba(0,228,255,0.6); font-size: 10px;">ç‚¹å‡»æŸ¥çœ‹ â–¶</span></div>
                <div class="alert-table">
                    <table>
                        <thead>
                            <tr>
                                <th>å‘Šè­¦ç±»å‹</th>
                                <th>å‘Šè­¦çº§åˆ«</th>
                                <th>å‘Šè­¦æ—¶é—´</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="alert-table-body">
                            <!-- åŠ¨æ€å‘Šè­¦æ•°æ® -->
                        </tbody>
                    </table>
                </div>
            </div>
            <!--å‘Šè­¦panel end-->
        </div>

        <div class="middle">
            <div class="headTitle">{{ BIGSCREEN_TITLE }}</div>
            <!--åœ°å›¾-->
            <div class="chinaMap" style="color: white;">
                <div class="circle0"></div>

                <div id="btn" style="display: none;">
                    <div style="position: relative;">
                        <div class="btn0"></div>
                        <div class="btn1"></div>
                        <div class="btn2"></div>
                    </div>
                </div>

                <div class="mapBox">
                    <div id="map">

                    </div>
                </div>
                
            </div>  
            <!--åœ°å›¾ end-->
            <!--åŠ¨ç”»-->
            <div class="lineRun">

            </div>
            <!--åŠ¨ç”» end-->
        </div>

        <div class="right">
            <!--è®¾å¤‡çŠ¶æ€-->
            <div class="rainfall device-status" onclick="navigateToDeviceView()" style="cursor: pointer;">
                <div class="air-title title numfont">è®¾å¤‡çŠ¶æ€ <span style="float: right; color: rgba(0,228,255,0.6); font-size: 10px;">ç‚¹å‡»æŸ¥çœ‹ â–¶</span></div>
                <!-- å®æ—¶çŠ¶æ€æŒ‡ç¤ºç¯ - ä¿®å¤æ˜¾ç¤ºé—®é¢˜ -->
                <div class="hp_con_right_u" style="height: 40%; margin-bottom: 3px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 6px; padding: 5px; height: 100%; box-sizing: border-box;">
                        <!-- ä½©æˆ´çŠ¶æ€ -->
                        <div style="text-align: center; background: rgba(0,228,255,0.1); border-radius: 6px; padding: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 0;">
                            <div id="wearStatus" class="breathe-zc" style="margin-bottom: 1px; width: 14px; height: 14px; flex-shrink: 0;"></div>
                            <div style="color: #00e4ff; font-size: 9px; font-weight: bold; line-height: 1;">ğŸ‘¤ ä½©æˆ´</div>
                            <div id="wearStatusText" style="color: #fff; font-size: 8px; line-height: 1;">æœªçŸ¥</div>
                        </div>
                        <!-- å……ç”µçŠ¶æ€ -->
                        <div style="text-align: center; background: rgba(0,255,136,0.1); border-radius: 6px; padding: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 0;">
                            <div id="chargeStatus" class="breathe-zc" style="margin-bottom: 1px; width: 14px; height: 14px; flex-shrink: 0;"></div>
                            <div style="color: #00ff88; font-size: 9px; font-weight: bold; line-height: 1;">ğŸ”‹ å……ç”µ</div>
                            <div id="chargeStatusText" style="color: #fff; font-size: 8px; line-height: 1;">æœªçŸ¥</div>
                        </div>
                        <!-- åœ¨çº¿çŠ¶æ€ -->
                        <div style="text-align: center; background: rgba(255,170,0,0.1); border-radius: 6px; padding: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 0;">
                            <div id="onlineStatus" class="breathe-zc" style="margin-bottom: 1px; width: 14px; height: 14px; flex-shrink: 0;"></div>
                            <div style="color: #ffaa00; font-size: 9px; font-weight: bold; line-height: 1;">ğŸ“¡ åœ¨çº¿</div>
                            <div id="onlineStatusText" style="color: #fff; font-size: 8px; line-height: 1;">æœªçŸ¥</div>
                        </div>
                        <!-- å‘Šè­¦çŠ¶æ€ -->
                        <div style="text-align: center; background: rgba(255,71,87,0.1); border-radius: 6px; padding: 2px; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 0;">
                            <div id="alertStatus" class="breathe-zc" style="margin-bottom: 1px; width: 14px; height: 14px; flex-shrink: 0;"></div>
                            <div style="color: #ff4757; font-size: 9px; font-weight: bold; line-height: 1;">âš ï¸ å‘Šè­¦</div>
                            <div id="alertStatusText" style="color: #fff; font-size: 8px; line-height: 1;">æ— å‘Šè­¦</div>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è¶‹åŠ¿å›¾ - å‚ç›´æ’åˆ—åœ¨ä¸‹æ–¹ -->
                <div style="height: 57%; padding: 3px; border-top: 1px solid rgba(0, 228, 255, 0.2);">
                    <div style="color: #00e4ff; font-size: 12px; margin-bottom: 5px; text-align: center; font-weight: bold;">å†å²è¶‹åŠ¿</div>
                    <div id="deviceHistoryChart" style="width: 100%; height: calc(100% - 20px);"></div>
                </div>
            </div>
            <!--è®¾å¤‡çŠ¶æ€ end-->
            
            <!--ä¸“ä¸šåŒ–æ¶ˆæ¯panel-->
            <div class="rainfall message-panel-pro" onclick="navigateToMessageView()">
                <div class="message-header-pro">
                    <div class="message-title-pro">ğŸ’¬ æ¶ˆæ¯é€šçŸ¥</div>
                    <div class="message-count-pro" id="messageCountPro">0</div>
                </div>
                <div class="message-scroll-container">
                    <div class="message-scroll-content" id="messageScrollContent">
                        <!-- åŠ¨æ€æ»šåŠ¨æ¶ˆæ¯å†…å®¹ -->
                    </div>
                </div>
                <div class="message-click-hint">ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ… â–¶</div>
            </div>
            <!--æ¶ˆæ¯panel end-->
            
            <!--å¥åº·ç”»åƒ - ä¸“ä¸šåŒ–æ”¹é€ -->
            <div class="wind health-dashboard" onclick="navigateToHealthAnalysis()" style="cursor: pointer;">
                <div class="air-title title numfont" style="position: absolute; top: 5px; left: 15px; color: #00e4ff; font-size: 14px; z-index: 1000; font-weight: bold;">å¥åº·ç”»åƒ <span style="float: right; color: rgba(0,228,255,0.6); font-size: 10px; margin-right: -100px;">ç‚¹å‡»åˆ†æ â–¶</span></div>
                
                <!-- å¥åº·æ¦‚è§ˆå¡ç‰‡ -->
                <div class="health-overview" style="position: absolute; top: 30px; right: 15px; z-index: 1000; display: flex; align-items: center; gap: 10px;">
                    <div class="overall-score" style="text-align: center;">
                        <div id="overallScore" style="color: #52c41a; font-size: 24px; font-weight: bold;">96.6</div>
                        <div style="color: #00e4ff; font-size: 10px;">æ€»è¯„åˆ†</div>
                    </div>
                    <div class="overall-status" style="text-align: center;">
                        <div id="overallStatus" style="color: #52c41a; font-size: 11px; font-weight: bold;">ä¼˜ç§€</div>
                        <div style="color: #ccc; font-size: 9px;">å¥åº·çŠ¶æ€</div>
                    </div>
                </div>
                
                <!-- é›·è¾¾å›¾å®¹å™¨ -->
                <div id="windChart" style="position: absolute; top: 25px; left: 0; right: 0; bottom: 0; width: 100%; height: calc(100% - 25px); margin: 0; padding: 0;">
                </div>
                
                <!-- å¥åº·è¯¦æƒ…æµ®å±‚ -->
                <div id="healthDetails" class="health-details-panel" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,21,41,0.95); z-index: 2000; padding: 15px; overflow-y: auto; border-radius: 8px; border: 1px solid rgba(0,228,255,0.3);">
                    <div class="details-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid rgba(0,228,255,0.3); padding-bottom: 10px;">
                        <h3 style="color: #00e4ff; margin: 0; font-size: 16px;">å¥åº·è¯¦æƒ…æŠ¥å‘Š</h3>
                        <button id="closeDetails" style="background: none; border: none; color: #ff6b6b; font-size: 18px; cursor: pointer;">âœ•</button>
                    </div>
                    <div id="healthDetailsContent" class="details-content">
                        <!-- åŠ¨æ€å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
                <div class="view-details-btn" style="position: absolute; bottom: 8px; right: 15px; z-index: 1000;">
                    <button id="showDetailsBtn" style="background: linear-gradient(135deg, rgba(0,228,255,0.3), rgba(0,180,255,0.5)); border: 1px solid rgba(0,228,255,0.4); color: #00e4ff; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; transition: all 0.3s ease;">
                        è¯¦æƒ… â†’
                    </button>
                </div>
            </div>
            <!--å¥åº·ç”»åƒ end-->
        </div>
    </div>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='personal-js/jquery-3.2.1.min.js') }}">

    <script src="{{ url_for('static', filename='personal-js/echarts.js') }}"></script>
    <script src="{{ url_for('static', filename='personal-js/china.js') }}"></script>
    <script src="{{ url_for('static', filename='personal-js/render.js') }}"></script>
 

    <script>
        function initialize() {
            for (var i = 0; i < 50; i++) {
                $('.air-relative').find('.gray').append('<span></span>');
                $('.air-absolutely').find('.gray').append('<span></span>')
            }
            var pressureValRel = 0; //åˆå§‹æ°”å‹(ç›¸å¯¹)
            var pressureValNowRel = 43; //å½“å‰æ°”å‹ï¼ˆç›¸å¯¹ï¼‰
            function airPreRel(now, old, par) {
                if (now > old) {
                    par.find('.light').append('<span></span>');
                    pressureValRel++;
                } else if (now < old) {
                    par.find('.light').children('span:last-child').remove();
                    pressureValRel--;
                } else {
                    clearInterval(pressureRunRel);
                    return
                }
                $('.hpa-rel').text(pressureValRel * 2);
            }
            var pressureRunRel = setInterval(function() {
                airPreRel(pressureValNowRel, pressureValRel, $('.air-relative'));
            }, 50);

            var pressureValAbs = 0; //åˆå§‹æ°”å‹(ç»å¯¹)
            var pressureValNowAbs = 33; //å½“å‰æ°”å‹ï¼ˆç»å¯¹ï¼‰
            function airPreAbs(now, old, par) {
                if (now > old) {
                    par.find('.light').append('<span></span>');
                    pressureValAbs++;
                } else if (now < old) {
                    par.find('.light').children('span:last-child').remove();
                    pressureValAbs--;
                } else {
                    clearInterval(pressureRunAbs);
                    return
                }
                $('.hpa-abs').text(pressureValAbs * 2);
            }
            var pressureRunAbs = setInterval(function() {
                airPreAbs(pressureValNowAbs, pressureValAbs, $('.air-absolutely'));
            }, 50);

            //æ¸©åº¦å’Œæ¹¿åº¦
            var heartRateChart = echarts.init(document.getElementById('heartRateChart'));
            var bloodOxygenChart = echarts.init(document.getElementById('bloodOxygenChart'));
            var pressureChart = echarts.init(document.getElementById('pressureChart'));
            var temperatureChart = echarts.init(document.getElementById('temperatureChart'));
            var heartRateOption = {
                tooltip: {
                    formatter: '{a}<br/>å½“å‰ï¼š{c}æ¬¡/åˆ†'
                },
                series: [
                    //å†…åœˆ
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '30%',
                        min: 0,
                        max: 10,
                        startAngle: 270,
                        endAngle: -89.99999,
                        splitNumber: 10,
                        axisLine: { // ä»ªè¡¨ç›˜è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#ff4500']
                                ],
                                width: 0,
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦æ ‡ç­¾
                            show: false
                        },
                        axisTick: { // åˆ»åº¦
                            length: 4, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'rgba(176,204,53,.5)'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            show: false
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //ä¸­åœˆ
                    {
                        name: 'è½¬é€Ÿ',
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '60%',
                        min: 0,
                        max: 10,
                        splitNumber: 10,
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#6E6560']
                                ],
                                width: 8,
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: '',
                                color: 'rgba(30,144,255,0)',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisTick: { // åæ ‡è½´å°æ ‡è®°
                            length: 2, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'auto'
                                /*shadowColor : '#fff', //é»˜è®¤é€æ˜
                                 shadowBlur: 10*/
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 0, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 0,
                                color: '#fff',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //å¤–åœˆå®¤å†…
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '100%',
                        min: 60,  // Updated minimum value
                        max: 150, // Updated maximum value
                        name: 'å¿ƒç‡',
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: {
                                color: [
                                    [0.33, '#FF0000'], // Red for 60-100
                                    [0.67, '#00FF00'], // Green for 100-130
                                    [1, '#FF0000']     // Red for 130-150
                                ], // Adjusted color segments
                                width: 1
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#FF0000'
                            }
                        },
                        axisTick: {
                            length: 3
                        },
                        axisLabel: { // åæ ‡è½´å°æ ‡è®°
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: 'bolder',
                                fontSize: 10,
                                fontFamily: 'numfont'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 5, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        pointer: {
                            width: 3,
                            length: '90%'
                        },
                        detail: {
                            show: false
                        },
                        data: [{
                            value: 87
                        }]
                    }
                ]
            };
            var bloodOxygenOption = {
                tooltip: {
                    formatter: '{a}<br/>å½“å‰ï¼š{c}'
                },
                series: [
                    //å†…åœˆ
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '30%',
                        min: 0,
                        max: 10,
                        startAngle: 270,
                        endAngle: -89.99999,
                        splitNumber: 10,
                        axisLine: { // ä»ªè¡¨ç›˜è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#ff4500']
                                ],
                                width: 0,
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦æ ‡ç­¾
                            show: false
                        },
                        axisTick: { // åˆ»åº¦
                            length: 4, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'rgba(176,204,53,.5)'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            show: false
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //ä¸­åœˆ
                    {
                        name: 'è½¬é€Ÿ',
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '60%',
                        min: 0,
                        max: 10,
                        splitNumber: 10,
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#6E6560']
                                ],
                                width: 8,

                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: '',
                                color: 'rgba(30,144,255,0)',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisTick: { // åæ ‡è½´å°æ ‡è®°
                            length: 2, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'auto'
                                /*shadowColor : '#fff', //é»˜è®¤é€æ˜
                                 shadowBlur: 10*/
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 0, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 0,
                                color: '#fff',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //å¤–åœˆå®¤å†…
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '100%',
                        min: 80,  // Updated minimum value
                        max: 100, // Updated maximum value
                        name: 'è¡€æ°§',
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: {
                                color: [
                                    [0.5, '#FF0000'], // Red for 80-90
                                    [1, '#00FF00']    // Green for 90-100
                                ], // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#FF0000'
                            }
                        },
                        axisTick: {
                            length: 3
                        },
                        axisLabel: { // åæ ‡è½´æ ‡è®°
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: 'bolder',
                                fontSize: 10,
                                fontFamily: 'numfont'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 5, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        pointer: {
                            width: 3,
                            length: '90%'
                        },
                        detail: {
                            show: false
                        },
                        data: [{
                            value: 87
                        }]
                    },
                    //å¤–åœˆå®¤å¤–
                    

                ]
            };
            var pressureOption = {
                tooltip: {
                    formatter: '{a}<br/>å½“å‰ï¼š{c}mmHg'
                },
                series: [
                    //å†…åœˆ
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '30%',
                        min: 0,
                        max: 10,
                        startAngle: 270,
                        endAngle: -89.99999,
                        splitNumber: 10,
                        axisLine: { // ä»ªè¡¨ç›˜è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#ff4500']
                                ],
                                width: 0,
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦æ ‡ç­¾
                            show: false
                        },
                        axisTick: { // åº¦
                            length: 4, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'rgba(176,204,53,.5)'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            show: false
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //ä¸­åœˆ
                    {
                        name: 'è½¬é€Ÿ',
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '60%',
                        min: 0,
                        max: 10,
                        splitNumber: 10,
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#6E6560']
                                ],
                                width: 8,

                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: '',
                                color: 'rgba(30,144,255,0)',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisTick: { // åæ ‡è½´å°æ ‡è®°
                            length: 2, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'auto'
                                /*shadowColor : '#fff', //é»˜è®¤é€æ˜
                                 shadowBlur: 10*/
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 0, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 0,
                                color: '#fff',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //å¤–åœˆå®¤å†…
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '100%',
                        min: 0,
                        max: 150,
                        name: 'é«˜å‹',
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: {
                                color: [
                                    [1, '#C7C5C3']
                                ], // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#FF0000'
                            }
                        },
                        axisTick: {
                            length: 3
                        },
                        axisLabel: { // åæ ‡è½´å°æ ‡è®°
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: 'bolder',
                                fontSize: 10,
                                fontFamily: 'numfont'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 5, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        pointer: {
                            width: 3,
                            length: '90%'
                        },
                        detail: {
                            show: false
                        },
                        data: [{
                            value: 101
                        }]
                    },
                    //å¤–åœˆå®¤å¤–
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '100%',
                        min: 0,
                        max: 150,
                        name: 'ä½å‹',
                        axisTick: {
                            length: 3
                        },
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: {
                                color: [
                                    [1, '#C7C5C3']
                                ], // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        pointer: {
                            width: 3,
                            length: '90%'
                        },
                        itemStyle: {
                            normal: {
                                color: '#B0CC35'
                            }

                        },
                        axisLabel: {
                            textStyle: {
                                fontWeight: 'bolder',
                                fontSize: 16,
                                color: 'rgba(30,144,255,0)'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 5, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        detail: {
                            show: false
                        },
                        data: [{
                            value: 88
                        }],
                        title: {
                            show: false
                        }
                    }

                ]
            };
            
            var temperatureOption = {
                tooltip: {
                    formatter: '{a}<br/>å½“å‰ï¼š{c}â„ƒ'
                },
                series: [
                    //å†…åœˆ
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '30%',
                        min: 0,
                        max: 10,
                        startAngle: 270,
                        endAngle: -89.99999,
                        splitNumber: 10,
                        axisLine: { // ä»ªè¡¨ç›˜è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#ff4500']
                                ],
                                width: 0,
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦æ ‡ç­¾
                            show: false
                        },
                        axisTick: { // åˆ»åº¦
                            length: 4, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'rgba(176,204,53,.5)'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            show: false
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //ä¸­åœˆ
                    {
                        name: 'è½¬é€Ÿ',
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '60%',
                        min: 0,
                        max: 10,
                        splitNumber: 10,
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: [
                                    [1, '#6E6560']
                                ],
                                width: 8,
                                shadowBlur: 10
                            }
                        },
                        axisLabel: { // åˆ»åº¦
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: '',
                                color: 'rgba(30,144,255,0)',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        axisTick: { // åæ ‡è½´å°æ ‡è®°
                            length: 2, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                color: 'auto'
                                /*shadowColor : '#fff', //é»˜è®¤é€æ˜
                                 shadowBlur: 10*/
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 0, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 0,
                                color: '#fff',
                                shadowColor: '#fff', //é»˜è®¤é€æ˜
                                shadowBlur: 10
                            }
                        },
                        pointer: {
                            width: 0,
                            shadowColor: '#fff', //é»˜è®¤é€æ˜
                            shadowBlur: 5
                        },
                        detail: {
                            show: false
                        }
                    },
                    //å¤–åœˆå®¤å†…
                    {
                        type: 'gauge',
                        center: ['50%', '60%'], // é»˜è®¤å…¨å±€å±…ä¸­
                        radius: '100%',
                        min: 34,  // Updated minimum value
                        max: 41,  // Updated maximum value
                        name: 'ä½“æ¸©',
                        axisLine: { // åæ ‡è½´çº¿
                            lineStyle: {
                                color: [
                                    [0.1429, '#FF0000'], // Red for 34-35
                                    [0.5, '#00FF00'],    // Green for 35-37.5
                                    [1, '#FF0000']       // Red for 37.5-41
                                ], // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        itemStyle: {
                            normal: {
                                color: '#FF0000'
                            }
                        },
                        axisTick: {
                            length: 3
                        },
                        axisLabel: { // åæ ‡è½´å°æ ‡è®°
                            textStyle: { // å±æ€§lineStyleæ§åˆ¶çº¿æ¡æ ·å¼
                                fontWeight: 'bolder',
                                fontSize: 10,
                                fontFamily: 'numfont'
                            }
                        },
                        splitLine: { // åˆ†éš”çº¿
                            length: 5, // å±æ€§lengthæ§åˆ¶çº¿é•¿
                            lineStyle: { // å±æ€§lineStyleï¼ˆè¯¦è§lineStyleï¼‰æ§åˆ¶çº¿æ¡æ ·å¼
                                width: 1
                            }
                        },
                        pointer: {
                            width: 3,
                            length: '90%'
                        },
                        detail: {
                            show: false
                        },
                        data: [{
                            value: 36.5
                        }]
                    }
                ]
            };
            heartRateChart.setOption(heartRateOption);
            bloodOxygenChart.setOption(bloodOxygenOption);
            pressureChart.setOption(pressureOption);
            temperatureChart.setOption(temperatureOption);

        

            // Define the function globally
            window.temHum = function(heartRateVal, bloodOxygenVal, pressureHighVal, pressureLowVal, temperatureVal) {
                heartRateOption.series[2].data[0].value = heartRateVal;
                heartRateChart.setOption(heartRateOption);
                
                $('.heartRate-val').find('.profile-button').text(heartRateVal);
                bloodOxygenOption.series[2].data[0].value = bloodOxygenVal;
                bloodOxygenChart.setOption(bloodOxygenOption);
                $('.bloodOxygen-val').find('.profile-button').text(bloodOxygenVal);
               
                pressureOption.series[2].data[0].value = pressureHighVal;
                pressureOption.series[3].data[0].value = pressureLowVal;
                pressureChart.setOption(pressureOption);
                console.log("temHum::pressureHighVal:", pressureHighVal);
                $('.pressure-val').find('.profile-button').text(`${pressureHighVal}/${pressureLowVal}`);
                temperatureOption.series[2].data[0].value = temperatureVal;
                
                temperatureChart.setOption(temperatureOption);
                $('.temperature-val').find('.profile-button').text(temperatureVal+ 'â„ƒ');
            };
            
            

            // æ›´æ–°å¥åº·ç”»åƒ - ç›´æ¥ä½¿ç”¨deviceSnè·å–æ•°æ®
            function updateHealthRadarChart() {
                const deviceSn = '{{ deviceSn }}' || 'CRFTQ23409001890';
                const customerId = '{{ customerId }}' || '1';
                console.log("å¼€å§‹è·å–å¥åº·ç”»åƒæ•°æ®ï¼Œè®¾å¤‡åºåˆ—å·:", deviceSn);
                
                // å»¶è¿Ÿç¡®ä¿DOMå®Œå…¨åŠ è½½
                setTimeout(() => {
                    const chartContainer = document.getElementById('windChart');
                    if (!chartContainer) {
                        console.error('å¥åº·ç”»åƒå®¹å™¨æœªæ‰¾åˆ°');
                        return;
                    }

                    //#ç›´æ¥ä½¿ç”¨deviceSnè°ƒç”¨å¥åº·è¯„åˆ†API
                                         fetch(`/health_data/score?orgId=${customerId}&deviceSn=${deviceSn}`)
                        .then(response => response.json())
                        .then(result => {
                            console.log('âœ… å¥åº·è¯„åˆ†APIå“åº”:', result);
                            
                            if (!result.success) {
                                throw new Error('å¥åº·è¯„åˆ†æ•°æ®è·å–å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                            }
                            
                            const healthScores = result.data.healthScores;
                            if (!healthScores) {
                                throw new Error('å¥åº·è¯„åˆ†æ•°æ®ä¸ºç©º');
                            }
                            
                            //#ä¿å­˜å®Œæ•´æ•°æ®ç”¨äºè¯¦æƒ…æ˜¾ç¤º
                            window.currentHealthData = result.data;
                            
                            //#æ›´æ–°æ€»ä½“å¥åº·è¯„åˆ†æ˜¾ç¤º
                            const overallScore = parseFloat(healthScores.overall || 0).toFixed(1);
                            const overallStatus = healthScores.overallStatus || {};
                            
                            document.getElementById('overallScore').textContent = overallScore;
                            document.getElementById('overallScore').style.color = overallStatus.color || '#52c41a';
                            document.getElementById('overallStatus').textContent = getStatusText(overallStatus.level);
                            document.getElementById('overallStatus').style.color = overallStatus.color || '#52c41a';
                            
                            //#æå–é›·è¾¾å›¾æ•°æ®
                            const factors = healthScores.factors || {};
                            const radarData = [
                                factors.heart_rate?.score || 70,      // å¿ƒç‡
                                factors.blood_oxygen?.score || 80,    // è¡€æ°§  
                                factors.temperature?.score || 75,     // ä½“æ¸©
                                factors.stress?.score || 65,          // å‹åŠ›
                                factors.sleep?.score || 85,           // ç¡çœ 
                                factors.step?.score || 90,            // æ­¥æ•°
                                Math.max(factors.pressure_high?.score || 70, factors.pressure_low?.score || 70) // è¡€å‹å–æœ€é«˜å€¼
                            ];  
                            
                            console.log("é›·è¾¾å›¾æ•°æ®:", radarData);

                            //#æ›´æ–°é›·è¾¾å›¾ - ä¿®å¤ç‰ˆ
                            const windOption = {
                                tooltip: {
                                    trigger: 'axis',
                                    backgroundColor: 'rgba(0,0,0,0.9)',
                                    borderColor: '#00ff88',
                                    borderWidth: 2,
                                    textStyle: { 
                                        color: '#fff',
                                        fontSize: 14,
                                        fontWeight: 'bold'
                                    },
                                    padding: [12, 18],
                                    formatter: function(params) {
                                        if (params && params.length > 0 && window.currentHealthData) {
                                            const factors = window.currentHealthData.healthScores.factors || {};
                                            const indicators = ['å¿ƒç‡', 'è¡€æ°§', 'ä½“æ¸©', 'å‹åŠ›', 'ç¡çœ ', 'æ­¥æ•°', 'è¡€å‹'];
                                            const factorKeys = ['heart_rate', 'blood_oxygen', 'temperature', 'stress', 'sleep', 'step', 'pressure_high'];
                                            
                                            let content = `<div style="text-align:center;margin-bottom:10px;color:#00ff88;font-size:16px;font-weight:bold;">å¥åº·è¯„åˆ†ï¼š${overallScore}</div>`;
                                            content += '<div style="border-bottom:2px solid #00ff88;margin-bottom:8px;"></div>';
                                            
                                            for(let i = 0; i < indicators.length && i < radarData.length; i++) {
                                                const factor = factors[factorKeys[i]];
                                                if (factor) {
                                                    const currentValue = factor.currentValue + (factor.unit || '');
                                                    const normalRange = factor.normalRange ? `${factor.normalRange[0]}-${factor.normalRange[1]}${factor.unit || ''}` : 'æ­£å¸¸';
                                                    const statusColor = factor.status === 'excellent' ? '#52c41a' : factor.status === 'normal' ? '#faad14' : '#ff4d4f';
                                                    
                                                    content += `<div style="margin:6px 0;display:flex;justify-content:space-between;align-items:center;">
                                                        <span style="color:#00e4ff;font-weight:bold;">${indicators[i]}:</span>
                                                        <span style="color:${statusColor};font-weight:bold;">${factor.score.toFixed(1)}åˆ†</span>
                                                    </div>
                                                    <div style="margin:2px 0 8px 0;font-size:12px;color:#aaa;text-align:right;">
                                                        å½“å‰: ${currentValue} | æ­£å¸¸: ${normalRange}
                                                    </div>`;
                                                }
                                            }
                                            return content;
                                        }
                                        return '';
                                    },
                                    extraCssText: 'box-shadow: 0 4px 20px rgba(0,255,136,0.4); border-radius: 8px;'
                                },
                                radar: {
                                    center: ['50%', '50%'],
                                    radius: '85%',
                                    indicator: [
                                        { name: 'å¿ƒç‡', max: 12, nameGap: 30 },
                                        { name: 'è¡€æ°§', max: 12, nameGap: 30 },
                                        { name: 'ä½“æ¸©', max: 12, nameGap: 30 },
                                        { name: 'å‹åŠ›', max: 12, nameGap: 30 },
                                        { name: 'ç¡çœ ', max: 12, nameGap: 30 },
                                        { name: 'æ­¥æ•°', max: 12, nameGap: 30 },
                                        { name: 'è¡€å‹', max: 12, nameGap: 30 }
                                    ],
                                    name: {
                                        textStyle: {
                                            color: '#00e4ff',
                                            fontWeight: 'bold',
                                            fontSize: 14,
                                            shadowColor: 'rgba(0,228,255,0.5)',
                                            shadowBlur: 2
                                        }
                                    },
                                    axisLine: {
                                        lineStyle: {
                                            color: '#00e4ff',
                                            width: 2
                                        }
                                    },
                                    splitLine: {
                                        lineStyle: {
                                            color: 'rgba(0, 228, 255, 0.6)',
                                            width: 1
                                        }
                                    },
                                    splitArea: {
                                        show: true,
                                        areaStyle: {
                                            color: ['rgba(0,50,80,0.3)', 'rgba(0,100,150,0.2)', 'rgba(0,50,80,0.3)', 'rgba(0,100,150,0.2)']
                                        }
                                    }
                                },
                                series: [{
                                    type: 'radar',
                                    data: [{
                                        value: radarData,
                                        name: 'å¥åº·æŒ‡æ ‡',
                                        itemStyle: {
                                            color: '#00ff88',
                                            borderColor: '#fff',
                                            borderWidth: 2,
                                            shadowColor: 'rgba(0,255,136,0.8)',
                                            shadowBlur: 10
                                        },
                                        areaStyle: {
                                            color: 'rgba(0,255,136,0.4)',
                                            shadowColor: 'rgba(0,255,136,0.3)',
                                            shadowBlur: 15
                                        },
                                        lineStyle: {
                                            color: '#00ff88',
                                            width: 4,
                                            shadowColor: 'rgba(0,255,136,1)',
                                            shadowBlur: 10
                                        }
                                    }],
                                    symbol: 'circle',
                                    symbolSize: 10,
                                    emphasis: {
                                        itemStyle: {
                                            color: '#fff',
                                            borderColor: '#00ff88',
                                            borderWidth: 3,
                                            shadowColor: 'rgba(255,255,255,0.8)',
                                            shadowBlur: 15
                                        }
                                    }
                                }]
                            };

                            const windChart = echarts.init(chartContainer);
                            windChart.setOption(windOption);
                            
                            // å¼ºåˆ¶resizeç¡®ä¿å›¾è¡¨æ­£ç¡®æ˜¾ç¤º
                            setTimeout(() => {
                                windChart.resize();
                                console.log('é›·è¾¾å›¾å®¹å™¨æœ€ç»ˆå°ºå¯¸:', document.getElementById('windChart').offsetWidth, 'x', document.getElementById('windChart').offsetHeight);
                            }, 200);
                            
                            windChart.resize(); // ç¡®ä¿å›¾è¡¨èƒ½æ­£ç¡®è°ƒæ•´å¤§å°
                            window.globalWindChart = windChart; // ä¿å­˜åˆ°å…¨å±€å˜é‡
                            console.log("é›·è¾¾å›¾å·²æ›´æ–°");
                        })
                        .catch(error => {
                            console.warn('å¥åº·è¯„åˆ†APIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', error.message || error);
                            //#æ˜¾ç¤ºé»˜è®¤æ•°æ®
                            $('#nowWind').text(64);
                            const defaultWindOption = {
                                tooltip: {
                                    trigger: 'axis',
                                    backgroundColor: 'rgba(0,0,0,0.9)',
                                    borderColor: '#00ff88',
                                    borderWidth: 2,
                                    textStyle: { 
                                        color: '#fff',
                                        fontSize: 14,
                                        fontWeight: 'bold'
                                    },
                                    padding: [12, 18],
                                    formatter: function(params) {
                                        if (params && params.length > 0) {
                                            const indicators = ['å¿ƒç‡', 'è¡€æ°§', 'ä½“æ¸©', 'å‹åŠ›', 'ç¡çœ ', 'æ­¥æ•°', 'è¡€å‹'];
                                            const baselines = ['86-118', '90-100', '36.5-37.2', '0-50', '7-9å°æ—¶', '8000+', '120-130'];
                                            const defaultScores = [23.3, 44.2, 59.2, 45.0, 88.3, 70.8, 83.3];
                                            let content = `<div style="text-align:center;margin-bottom:10px;color:#00ff88;font-size:16px;font-weight:bold;">å¥åº·æŒ‡æ•°ï¼š64</div>`;
                                            content += '<div style="border-bottom:2px solid #00ff88;margin-bottom:8px;"></div>';
                                            for(let i = 0; i < indicators.length; i++) {
                                                content += `<div style="margin:6px 0;display:flex;justify-content:space-between;align-items:center;">
                                                    <span style="color:#00e4ff;font-weight:bold;">${indicators[i]}:</span>
                                                    <span style="color:#00ff88;font-weight:bold;">${defaultScores[i]}åˆ†</span>
                                                </div>
                                                <div style="margin:2px 0 8px 0;font-size:12px;color:#aaa;text-align:right;">
                                                    æ­£å¸¸èŒƒå›´: ${baselines[i]}
                                                </div>`;
                                            }
                                            return content;
                                        }
                                        return '';
                                    },
                                    extraCssText: 'box-shadow: 0 4px 20px rgba(0,255,136,0.4); border-radius: 8px;'
                                },
                                radar: {
                                    center: ['50%', '50%'],
                                    radius: '85%',
                                    indicator: [
                                        { name: 'å¿ƒç‡', max: 12, nameGap: 30 },
                                        { name: 'è¡€æ°§', max: 12, nameGap: 30 },
                                        { name: 'ä½“æ¸©', max: 12, nameGap: 30 },
                                        { name: 'å‹åŠ›', max: 12, nameGap: 30 },
                                        { name: 'ç¡çœ ', max: 12, nameGap: 30 },
                                        { name: 'æ­¥æ•°', max: 12, nameGap: 30 },
                                        { name: 'è¡€å‹', max: 12, nameGap: 30 }
                                    ],
                                    name: {
                                        textStyle: {
                                            color: '#00e4ff',
                                            fontWeight: 'bold',
                                            fontSize: 14,
                                            shadowColor: 'rgba(0,228,255,0.5)',
                                            shadowBlur: 2
                                        }
                                    },
                                    axisLine: {
                                        lineStyle: {
                                            color: '#00e4ff',
                                            width: 2
                                        }
                                    },
                                    splitLine: {
                                        lineStyle: {
                                            color: 'rgba(0, 228, 255, 0.6)',
                                            width: 1
                                        }
                                    },
                                    splitArea: {
                                        show: true,
                                        areaStyle: {
                                            color: ['rgba(0,50,80,0.3)', 'rgba(0,100,150,0.2)', 'rgba(0,50,80,0.3)', 'rgba(0,100,150,0.2)']
                                        }
                                    }
                                },
                                series: [{
                                    type: 'radar',
                                    data: [{
                                        value: [2.8, 5.3, 7.1, 5.4, 10.6, 8.5, 10.0],
                                        name: 'å¥åº·æŒ‡æ ‡',
                                        itemStyle: {
                                            color: '#00ff88',
                                            borderColor: '#fff',
                                            borderWidth: 2,
                                            shadowColor: 'rgba(0,255,136,0.8)',
                                            shadowBlur: 10
                                        },
                                        areaStyle: {
                                            color: 'rgba(0,255,136,0.4)',
                                            shadowColor: 'rgba(0,255,136,0.3)',
                                            shadowBlur: 15
                                        },
                                        lineStyle: {
                                            color: '#00ff88',
                                            width: 4,
                                            shadowColor: 'rgba(0,255,136,1)',
                                            shadowBlur: 10
                                        }
                                    }],
                                    symbol: 'circle',
                                    symbolSize: 10,
                                    emphasis: {
                                        itemStyle: {
                                            color: '#fff',
                                            borderColor: '#00ff88',
                                            borderWidth: 3,
                                            shadowColor: 'rgba(255,255,255,0.8)',
                                            shadowBlur: 15
                                        }
                                    }
                                }]
                            };

                            const windChart = echarts.init(chartContainer);
                            windChart.setOption(defaultWindOption);
                            windChart.resize(); // ç¡®ä¿å›¾è¡¨èƒ½æ­£ç¡®è°ƒæ•´å¤§å°
                            window.globalWindChart = windChart; // ä¿å­˜åˆ°å…¨å±€å˜é‡
                            console.log("é›·è¾¾å›¾å·²æ›´æ–°");
                        });
                }, 100);
            }

            //#çŠ¶æ€çº§åˆ«è½¬æ¢ä¸ºä¸­æ–‡
            window.getStatusText = function(level) {
                const statusMap = {
                    'excellent': 'ä¼˜ç§€',
                    'good': 'è‰¯å¥½',
                    'normal': 'æ­£å¸¸',
                    'warning': 'é¢„è­¦',
                    'danger': 'å±é™©'
                };
                return statusMap[level] || 'æ­£å¸¸';
            };
            
            //#å¥åº·è¯¦æƒ…é¢æ¿æ˜¾ç¤º
            window.showHealthDetails = function() {
                if (!window.currentHealthData) {
                    console.warn('æ²¡æœ‰å¥åº·æ•°æ®å¯æ˜¾ç¤º');
                    return;
                }
                
                const data = window.currentHealthData;
                const healthScores = data.healthScores;
                const details = healthScores.details || {};
                
                let detailsHtml = `
                    <div class="overall-summary" style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0,228,255,0.1); border-radius: 8px;">
                        <div style="color: ${healthScores.overallStatus.color}; font-size: 32px; font-weight: bold;">${healthScores.overall.toFixed(1)}</div>
                        <div style="color: #00e4ff; font-size: 14px; margin: 5px 0;">${healthScores.overallStatus.message}</div>
                        <div style="color: #ccc; font-size: 12px;">æ•°æ®æ—¶é—´: ${data.summary.dataRange.start} è‡³ ${data.summary.dataRange.end}</div>
                    </div>
                `;
                
                //#ç”Ÿæˆå„é¡¹æŒ‡æ ‡è¯¦æƒ…
                const indicators = [
                    {key: 'heart_rate', name: 'å¿ƒç‡', icon: 'ğŸ’“'},
                    {key: 'blood_oxygen', name: 'è¡€æ°§', icon: 'ğŸ«'},
                    {key: 'temperature', name: 'ä½“æ¸©', icon: 'ğŸŒ¡ï¸'},
                    {key: 'pressure_high', name: 'æ”¶ç¼©å‹', icon: 'â¤ï¸'},
                    {key: 'pressure_low', name: 'èˆ’å¼ å‹', icon: 'ğŸ’–'},
                    {key: 'sleep', name: 'ç¡çœ ', icon: 'ğŸ˜´'},
                    {key: 'step', name: 'æ­¥æ•°', icon: 'ğŸ‘Ÿ'},
                    {key: 'stress', name: 'å‹åŠ›', icon: 'ğŸ˜°'},
                    {key: 'calorie', name: 'çƒ­é‡', icon: 'ğŸ”¥'},
                    {key: 'distance', name: 'è·ç¦»', icon: 'ğŸ“'}
                ];
                
                indicators.forEach(item => {
                    const detail = details[item.key];
                    const factor = healthScores.factors[item.key];
                    
                    if (detail && factor) {
                        const statusColor = factor.status === 'excellent' ? '#52c41a' : factor.status === 'normal' ? '#faad14' : '#ff4d4f';
                        
                        detailsHtml += `
                            <div class="health-item" style="margin-bottom: 15px; padding: 12px; background: rgba(0,21,41,0.5); border-radius: 8px; border-left: 4px solid ${statusColor};">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <span style="font-size: 18px;">${item.icon}</span>
                                        <span style="color: #00e4ff; font-size: 14px; font-weight: bold;">${item.name}</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: ${statusColor}; font-size: 16px; font-weight: bold;">${factor.score.toFixed(1)}åˆ†</span>
                                        <span style="color: ${statusColor}; font-size: 12px; padding: 2px 6px; background: rgba(255,255,255,0.1); border-radius: 4px;">${getStatusText(factor.status)}</span>
                                    </div>
                                </div>
                                <div style="color: #fff; font-size: 13px; margin-bottom: 6px;">${detail.message}</div>
                                <div style="color: #ccc; font-size: 11px; margin-bottom: 8px;">
                                    å½“å‰å€¼: ${factor.currentValue}${factor.unit} | æ­£å¸¸èŒƒå›´: ${factor.normalRange[0]}-${factor.normalRange[1]}${factor.unit}
                                </div>
                                ${detail.suggestions && detail.suggestions.length > 0 ? `
                                    <div style="margin-top: 8px;">
                                        <div style="color: #00e4ff; font-size: 11px; margin-bottom: 4px;">ğŸ’¡ å»ºè®®:</div>
                                        ${detail.suggestions.map(suggestion => `
                                            <div style="color: #aaa; font-size: 10px; margin-left: 15px; margin-bottom: 2px;">â€¢ ${suggestion}</div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                });
                
                document.getElementById('healthDetailsContent').innerHTML = detailsHtml;
                document.getElementById('healthDetails').style.display = 'block';
            };
            
            //#ç»‘å®šè¯¦æƒ…é¢æ¿äº‹ä»¶
            document.addEventListener('DOMContentLoaded', function() {
                document.getElementById('showDetailsBtn').addEventListener('click', showHealthDetails);
                document.getElementById('closeDetails').addEventListener('click', function() {
                    document.getElementById('healthDetails').style.display = 'none';
                });
            });

            // åˆå§‹åŒ–æ—¶æ›´æ–°é›·è¾¾å›¾
            updateHealthRadarChart();
            
            // å®šæœŸæ›´æ–°é›·è¾¾å›¾æ•°æ®ï¼ˆæ¯30ç§’ï¼‰
            setInterval(updateHealthRadarChart, 30000);

            // é£é€Ÿä¸é˜µé£æ•°æ®æ›´æ–°
            var speed = {
                wind: [86, 42],  // ä¿ç•™ç”¨äºåŠ¨ç”»è®¡ç®—
                gust: [2.8, 4.3]
            };

            function getData() {
                // ä¸å†è¦†ç›– nowWindï¼Œè®©APIæ•°æ®ç”Ÿæ•ˆ
                // $('#nowWind').text(speed.wind[0]);  // æ³¨é‡Šæ‰ï¼Œé˜²æ­¢è¦†ç›–APIæ•°æ®
                $('#highWind').text(speed.wind[1]);
                var windSpeed = (50 - speed.wind[0]) * 10;
                $('.windSpeed .windFan').css('animation-duration', windSpeed + 'ms');
                $('#nowGust').text(speed.gust[0]);
                $('#highGust').text(speed.gust[1]);
                var gustSpeed = (50 - speed.gust[0]) * 10;
                $('.gust .windFan').css('animation-duration', gustSpeed + 'ms');
            }
            getData();

        };
        initialize();
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´é›·è¾¾å›¾å¤§å°
        window.addEventListener('resize', function() {
            if (window.globalWindChart) {
                window.globalWindChart.resize();
                console.log('é›·è¾¾å›¾å·²é‡æ–°è°ƒæ•´å¤§å°');
            }
        });
    </script>

    <style>
    .device-status {
        display: flex;
        justify-content: space-around;
        padding: 20px;
        background-color: #333;
        color: #fff;
    }

    .status-item {
        text-align: center;
        transition: transform 0.3s;
    }

    .status-item:hover {
        transform: scale(1.1);
    }

    .status-title {
        margin-bottom: 10px;
        font-size: 16px;
    }

    .status-icon {
        font-size: 24px;
        transition: color 0.3s, transform 0.3s;
    }

    .icon {
        transition: color 0.3s, transform 0.3s;
    }

    .icon.active {
        color: green;
        animation: pulse 1s infinite;
    }

    .icon.inactive {
        color: red;
    }

    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.2);
        }
    }
    </style>

    <script type="text/javascript">
	
		
		//è®¾ç½®æ¸ é“çŠ¶æ€
		function qdzt(){
			//breathe-zc ç»¿ç¯ï¼›breathe-yc çº¢ç¯
			$("#dx").removeClass("breathe-yc");
			$("#dx").addClass("breathe-zc");
	
			$("#cz").removeClass("breathe-zc");
			$("#cz").addClass("breathe-yc");
	
			$("#gt").removeClass("breathe-yc");
			$("#gt").addClass("breathe-zc");

			$("#dlbxsp").removeClass("breathe-yc");
			$("#dlbxsp").addClass("breathe-zc");
		}
	</script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            async function fetchData() {
                try {
                    // Fetch data from the API
                    const response = await fetch(`./get_personal_info?deviceSn={{deviceSn}}`);
            
                    //console.log("get_personal_info response:", response);
            
                    // Check content type
                    const contentType = response.headers.get("content-type");
                    if (contentType && contentType.includes("application/json")) {
                        const personalData = await response.json();
                        console.log("get_personal_info response:", personalData);
                        
                        // Ensure data structure is valid
                        if (personalData && personalData.success) {
                            // Access health data correctly based on the actual response structure
                            const healthData = personalData.data.health_data.data.healthData[0];
                            console.log("DOMContentLoaded::healthData:", healthData);
                            if (healthData) {
                                //#å…¼å®¹é©¼å³°å’Œä¸‹åˆ’çº¿å‘½åæ ¼å¼çš„å¥åº·æ•°æ®è·å–
                                const heartRate = parseInt(healthData.heartRate || healthData.heart_rate) || 0;
                                const bloodOxygen = parseInt(healthData.bloodOxygen || healthData.blood_oxygen) || 0;
                                const temperature = parseFloat(healthData.temperature) || 36.5;
                                //#è¡€å‹æ•°æ®è·å–å…¼å®¹ä¸¤ç§æ ¼å¼ï¼Œç¼ºå¤±æ—¶ä½¿ç”¨å¿ƒç‡ä¼°ç®—
                                let pressureHigh = parseInt(healthData.pressureHigh || healthData.pressure_high) || 0;
                                let pressureLow = parseInt(healthData.pressureLow || healthData.pressure_low) || 0;
                                //#è¡€å‹ä¼°ç®—é€»è¾‘ï¼šå½“è¡€å‹ä¸º0ä½†å¿ƒç‡æœ‰å€¼æ—¶åŸºäºå¿ƒç‡ä¼°ç®—
                                if (pressureHigh === 0 && heartRate > 0) {
                                    pressureHigh = heartRate + 35; //#æ”¶ç¼©å‹=å¿ƒç‡+35
                                    pressureLow = Math.max(heartRate - 5, 60); //#èˆ’å¼ å‹=å¿ƒç‡-5ï¼Œæœ€å°60
                                }
                                
                                console.log("å…¼å®¹ä¿®å¤åçš„å¥åº·æ•°æ®:", {heartRate, bloodOxygen, pressureHigh, pressureLow, temperature});
                                
                                // Initialize page components with the fetched data
                                temHum(heartRate, bloodOxygen, pressureHigh, pressureLow, temperature);
                                
                                //#æ›´æ–°å¥åº·ç”»åƒæ˜¾ç¤ºæ•°æ®
                                updateHealthDisplayValues(healthData);
                            } else {
                                console.error('Health data is undefined:', personalData.data.health_data);
                            }

                            // Access device info correctly based on the actual response structure
                            const deviceInfo = personalData.data.device_info.data.devices[0];
                            console.log("DOMContentLoaded1::device_info:", deviceInfo);
                            // Device info handling
                            if (deviceInfo) {
                                const chargingStatus = deviceInfo.charging_status || 'UNKNOWN';
                                const wearableStatus = deviceInfo.wearable_status || 'UNKNOWN';
                                const onlineStatus = deviceInfo.status || 'UNKNOWN';
                
                                // Update charging status
                                if (chargingStatus === 'NOT_CHARGING') {
                                    $("#chargeStatus").removeClass("breathe-zc").addClass("breathe-yc");
                                } else {
                                    $("#chargeStatus").removeClass("breathe-yc").addClass("breathe-zc");
                                }
                
                                // Update wearable status
                                if (wearableStatus === 'NOT_WORN') {
                                    $("#wearStatus").removeClass("breathe-zc").addClass("breathe-yc");
                                } else {
                                    $("#wearStatus").removeClass("breathe-yc").addClass("breathe-zc");
                                }
                
                                // Update online status
                                if (onlineStatus === 'INACTIVE') {
                                    $("#onlineStatus").removeClass("breathe-zc").addClass("breathe-yc");
                                } else {
                                    $("#onlineStatus").removeClass("breathe-yc").addClass("breathe-zc");
                                }
                            }

                            // Access alerts correctly based on the actual response structure
                            const alerts = personalData.data.alert_info.data.alerts;
                            console.log("DOMContentLoaded::alertInfo:", alerts);
                            // Handle alert_info
                            if (alerts && alerts.length > 0) {
                                const alertTableBody = document.getElementById('alert-table-body');
                                alertTableBody.innerHTML = '';
                                // å…ˆæŒ‰çŠ¶æ€æ’åºï¼Œpendingä¼˜å…ˆ
                                alerts.sort((a, b) => {
                                    if (a.alert_status === 'pending' && b.alert_status !== 'pending') return -1;
                                    if (a.alert_status !== 'pending' && b.alert_status === 'pending') return 1;
                                    return 0;
                                });
                                
                                alerts.slice(0, 3).forEach(alert => {
                                    const row = document.createElement('tr');
                                    const statusText = alert.alert_status === 'pending' ? 'å¾…å¤„ç†' : 
                                                     alert.alert_status === 'responded' ? 'å·²å¤„ç†' : 
                                                     alert.alert_status === 'ignored' ? 'å·²å¿½ç•¥' : 'æœªçŸ¥';
                                    
                                    row.innerHTML = `
                                        <td>${alert.alert_type || 'æœªçŸ¥'}</td>
                                        <td>
                                            <span class="level ${alert.severity_level || 'unknown'}">
                                                ${mapSeverityLevel(alert.severity_level) || 'æœªçŸ¥'}
                                            </span>
                                        </td>   
                                        <td>${alert.alert_timestamp || 'æœªçŸ¥æ—¶é—´'}</td>
                                                                <td>
                            ${alert.alert_status === 'pending' ? 
                                `<button class="profile-button alert-process-btn" onclick="handleAlert('${alert.alert_id}')">ä¸€é”®å¤„ç†</button>` :
                                statusText}
                        </td>
                                    `;
                                    alertTableBody.appendChild(row);
                                });
                
                                // Update alert status indicator
                                if (alerts.length > 0) {
                                    $("#alertStatus").removeClass("breathe-zc").addClass("breathe-yc");
                                } else {
                                    $("#alertStatus").removeClass("breathe-yc").addClass("breathe-zc");
                                }
                            }
                            
                            // å¤„ç†æ¶ˆæ¯ä¿¡æ¯ - ä¸“ä¸šåŒ–æ»šåŠ¨æ˜¾ç¤º
                            const messageInfo = personalData.data.message_info.data;
                            const messages = messageInfo.messages;
                            console.log("DOMContentLoaded::messageInfo:", messages);
                            
                            updateMessageScrollPanel(messages);
                            
                        } else {
                            console.error('Failed to fetch personal info:', personalData.error || 'Unknown error');
                        }
                    } else {
                        console.error('Response is not JSON:', await response.text());
                    }
                } catch (error) {
                    console.error('Error fetching personal info:', error.message || error);
                    //alert('æ— æ³•åŠ è½½ä¸ªäººä¿¡æ¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                }
            }

            //#æ·»åŠ å¥åº·ç”»åƒæ•°æ®æ›´æ–°å‡½æ•°ï¼Œå…¼å®¹é©¼å³°å’Œä¸‹åˆ’çº¿å‘½åæ ¼å¼
            window.updateHealthDisplayValues = function(healthData) {
                if (!healthData) return;
                
                const heartRate = parseFloat(healthData.heartRate || healthData.heart_rate) || 2.8;
                const bloodOxygen = parseFloat(healthData.bloodOxygen || healthData.blood_oxygen) || 5.3;
                const temperature = parseFloat(healthData.temperature) || 7.1;
                const stress = parseFloat(healthData.stress) || 5.4;
                const sleep = parseFloat(healthData.sleep) || 10.6;
                const step = parseFloat(healthData.step) || 8.5;
                
                //#æ›´æ–°å¥åº·ç”»åƒæ˜¾ç¤ºçš„å…·ä½“æ•°å€¼
                const windBoxes = document.querySelectorAll('.windBox');
                if (windBoxes.length >= 2) {
                    //#æ›´æ–°ç¬¬ä¸€ä¸ªwindBoxçš„æ•°æ®
                    const firstBox = windBoxes[0];
                    const spans = firstBox.querySelectorAll('span');
                    if (spans.length >= 6) {
                        spans[1].textContent = `å¿ƒç‡ï¼š${(heartRate/30*10).toFixed(1)}`;
                        spans[2].textContent = `è¡€æ°§ï¼š${(bloodOxygen/100*10).toFixed(1)}`;
                        spans[3].textContent = `ä½“æ¸©ï¼š${temperature > 0 ? (temperature/40*10).toFixed(1) : '7.1'}`;
                        spans[4].textContent = `å‹åŠ›ï¼š${stress > 0 ? (stress/100*10).toFixed(1) : '5.4'}`;
                        spans[5].textContent = `ç¡çœ ï¼š${sleep > 0 ? (sleep/24*10).toFixed(1) : '10.6'}`;
                        if (spans[6]) spans[6].textContent = `æ­¥æ•°ï¼š${step > 0 ? (step/10000*10).toFixed(1) : '8.5'}`;
                    }
                }
                
                console.log("å·²æ›´æ–°å¥åº·ç”»åƒæ˜¾ç¤ºæ•°æ®ï¼Œå…¼å®¹åŒæ ¼å¼");
            };

            // Fetch data initially and then every 5 seconds
            fetchData();
            setInterval(fetchData, 5000);
           
        });
    </script>
    <script>
        const socket = io.connect();  // Adjust the URL as needed
        console.log("socket", socket);

        // Log when the connection is established
        socket.on('connect', function() {
            console.log('Connected to socket server');
        });

        // Log any connection errors
        socket.on('connect_error', function(error) {
            console.error('Connection error:', error);
        });

        // Listen for the personal_info_update event
        socket.on('personal_info_update', function(data) {
            console.log("personal_info_update socketæ•°æ®:", data.data.health_data);
            //#å…¼å®¹socketæ•°æ®å­—æ®µåé—®é¢˜å¹¶å®Œå–„è¡€å‹ä¼°ç®—é€»è¾‘
            const healthData = data.data.health_data;
            const hRate = parseInt(healthData.heart_rate || healthData.heartRate) || 0;
            const bOxy = parseInt(healthData.blood_oxygen || healthData.bloodOxygen) || 0;
            const temp = parseFloat(healthData.temperature) || 36.5;
            //#è¡€å‹æ•°æ®è·å–å…¼å®¹ä¸¤ç§æ ¼å¼ï¼Œå½“è¡€å‹ä¸º0æ—¶ä½¿ç”¨å¿ƒç‡ä¼°ç®—
            let pHigh = parseInt(healthData.pressure_high || healthData.pressureHigh) || 0;
            let pLow = parseInt(healthData.pressure_low || healthData.pressureLow) || 0;
            if (pHigh === 0 && hRate > 0) {
                pHigh = hRate + 35; //#æ”¶ç¼©å‹=å¿ƒç‡+35
                pLow = Math.max(hRate - 5, 60); //#èˆ’å¼ å‹=å¿ƒç‡-5ï¼Œæœ€å°60
            }
            
            console.log("socketä¿®å¤åæ•°æ®:", {hRate, bOxy, pHigh, pLow, temp});
            temHum(hRate, bOxy, pHigh, pLow, temp);
            //console.log(data.data.device_info);
            // Update charging status
            if (data.data.device_info.charging_status === 'NOT_CHARGING') {
                $("#chargeStatus").removeClass("breathe-zc").addClass("breathe-yc");
            } else {
                $("#chargeStatus").removeClass("breathe-yc").addClass("breathe-zc");
            }

            // Update wearable status
            if (data.data.device_info.wearable_status === 'NOT_WORN') {
                $("#wearStatus").removeClass("breathe-zc").addClass("breathe-yc");
            } else {
                $("#wearStatus").removeClass("breathe-yc").addClass("breathe-zc");
            }

            // Update online status
            if (data.data.device_info.status === 'INACTIVE') {
                $("#onlineStatus").removeClass("breathe-zc").addClass("breathe-yc");
            } else {
                $("#onlineStatus").removeClass("breathe-yc").addClass("breathe-zc");
            }

            // Update alert status
            if (Object.keys(data.data.alert_info).length > 0) {
                $("#alertStatus").removeClass("breathe-zc").addClass("breathe-yc");
            } else {
                $("#alertStatus").removeClass("breathe-yc").addClass("breathe-zc");
            }
            // Handle alert_info
            if (data.data.alert_info && typeof data.data.alert_info === 'object') {
                const alertTableBody = document.getElementById('alert-table-body');
                alertTableBody.innerHTML = '';
            
                // å°†å¯¹è±¡çš„å€¼è½¬æ¢ä¸ºæ•°ç»„å¹¶è§£æ JSON å­—ç¬¦ä¸²
                const alerts = Object.values(data.data.alert_info).map(alertStr => JSON.parse(alertStr));
            
                // å…ˆæŒ‰çŠ¶æ€æ’åºï¼Œpendingä¼˜å…ˆ
                alerts.sort((a, b) => {
                    if (a.alert_status === 'pending' && b.alert_status !== 'pending') return -1;
                    if (a.alert_status !== 'pending' && b.alert_status === 'pending') return 1;
                    return 0;
                });
                
                alerts.slice(0, 3).forEach(alert => {
                    const row = document.createElement('tr');
                    const statusText = alert.alert_status === 'pending' ? 'å¾…å¤„ç†' : 
                                     alert.alert_status === 'handled' ? 'å·²å¤„ç†' : 
                                     alert.alert_status === 'ignored' ? 'å·²å¿½ç•¥' : 'æœªçŸ¥';
                    
                    row.innerHTML = `
                        <td>${alert.alert_type || 'æœªçŸ¥'}</td>
                        <td>
                            <span class="level ${alert.severity_level || 'unknown'}">
                                ${mapSeverityLevel(alert.severity_level) || 'æœªçŸ¥'}
                            </span>
                        </td>   
                        <td>${alert.alert_timestamp || 'æœªçŸ¥æ—¶é—´'}</td>
                        <td>
                            ${alert.alert_status === 'pending' ? 
                                `<button class="profile-button alert-process-btn" onclick="handleAlert('${alert.alert_id}')">ä¸€é”®å¤„ç†</button>` :
                                statusText}
                        </td>
                    `;
                    alertTableBody.appendChild(row);
                });
            
                // Update alert status indicator
                if (alerts.length > 0) {
                    $("#alertStatus").removeClass("breathe-zc").addClass("breathe-yc");
                } else {
                    $("#alertStatus").removeClass("breathe-yc").addClass("breathe-zc");
                }
            }

            //æ›´æ–°ä¸“ä¸šåŒ–æ¶ˆæ¯é¢æ¿
            if (data.data.message_info && typeof data.data.message_info === 'object') {
                const messages = Object.values(data.data.message_info).map(messageStr => JSON.parse(messageStr));
                console.log("refreshData::messages:", messages);
                updateMessageScrollPanel(messages);
            }

            // Update the DOM with the new data
            //const personalInfoDiv = document.getElementById('personal-info');
            //personalInfoDiv.innerHTML = JSON.stringify(data.data, null, 2);  // Example: display JSON data
        });
    </script>
    <script>
        function mapSeverityLevel(severityLevel) {
            switch (severityLevel) {
                case 'critical':
                    return 'ä¸€çº§';
                case 'high':
                    return 'äºŒçº§';
                case 'medium':
                    return 'ä¸‰çº§';
                default:
                    return 'å…¶ä»–';
            }
        }

        function mapMessageType(messageType) {
            switch (messageType) {
                case 'announcement':
                    return 'å…¬å‘Š';
                case 'warning':
                    return 'è­¦å‘Š';
                case 'notification':
                    return 'é€šçŸ¥';
                case 'task':
                    return 'ä»»åŠ¡ç®¡ç†';
                case 'job':
                    return 'ä½œä¸šæŒ‡å¼•';
                default:
                    return 'æœªçŸ¥';
            }
        }
        function mapMessageStatus(status) {
            const statusMap = {
                '1': 'æœªå“åº”',
                '0': 'å·²å“åº”',
            };
            return statusMap[status] || 'æœªå“åº”';
        }

        //#ä¼˜åŒ–æ¶ˆæ¯é¢æ¿ - 3æ¡æ¶ˆæ¯å¾ªç¯æ»šåŠ¨æ˜¾ç¤º
        function updateMessageScrollPanel(messages) {
            const scrollContent = document.getElementById('messageScrollContent');
            const messageCount = document.getElementById('messageCountPro');
            
            if (!messages || messages.length === 0) {
                scrollContent.innerHTML = '<div class="message-item-pro"><div class="message-content-pro">æš‚æ— æ¶ˆæ¯é€šçŸ¥</div><div class="message-meta-pro"><div class="message-type-pro notification">ç³»ç»Ÿ</div><div class="message-time-pro">--</div></div></div>';
                messageCount.textContent = '0';
                scrollContent.classList.remove('scrolling');
                return;
            }
            
            messageCount.textContent = messages.length;
            
            //#å¤„ç†æ¶ˆæ¯æ•°é‡ï¼šæœ€å¤šæ˜¾ç¤º6æ¡ï¼Œç¡®ä¿å¾ªç¯æ»šåŠ¨æ•ˆæœ
            let displayMessages = [];
            if (messages.length <= 3) {
                //#æ¶ˆæ¯æ•°é‡å°‘äºç­‰äº3æ¡ï¼Œä¸æ»šåŠ¨
                displayMessages = messages.slice(0, 3);
            } else {
                //#æ¶ˆæ¯æ•°é‡å¤§äº3æ¡ï¼Œå–å‰4æ¡å¹¶å¤åˆ¶ä¸€éç”¨äºå¾ªç¯
                const limitedMessages = messages.slice(0, 4);
                displayMessages = [...limitedMessages, ...limitedMessages];
            }
            
            let content = '';
            displayMessages.forEach((message, index) => {
                const typeClass = message.message_type || 'notification';
                const typeName = mapMessageType(message.message_type);
                const timeStr = message.sent_time ? 
                    new Date(message.sent_time).toLocaleString('zh-CN', {
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit', 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit'
                    }).replace(/\//g, '-') : 
                    'åˆšåˆš';
                
                content += `
                    <div class="message-item-pro">
                        <div class="message-content-pro">${message.message || 'æœªçŸ¥æ¶ˆæ¯'}</div>
                        <div class="message-meta-pro">
                            <div class="message-type-pro ${typeClass}">${typeName}</div>
                            <div class="message-time-pro">${timeStr}</div>
                        </div>
                    </div>
                `;
            });
            
            scrollContent.innerHTML = content;
            
            //#å¯åŠ¨æ»šåŠ¨åŠ¨ç”»ï¼šè¶…è¿‡3æ¡æ¶ˆæ¯æ‰æ»šåŠ¨
            if (messages.length > 3) {
                scrollContent.style.animationDuration = '16s'; //#å›ºå®š16ç§’å¾ªç¯å‘¨æœŸ
                scrollContent.classList.remove('scrolling');
                setTimeout(() => {
                    scrollContent.classList.add('scrolling');
                }, 100); //#å»¶è¿Ÿå¯åŠ¨ç¡®ä¿å†…å®¹æ¸²æŸ“å®Œæˆ
            } else {
                scrollContent.classList.remove('scrolling');
            }
        }

        //#é€šç”¨æ¨¡æ€çª—å£åˆ›å»ºå‡½æ•°
        function createModalWindow(url, title, width, height) {
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-container';
            modalContainer.innerHTML = `
                <div class="modal-content">
                    <button class="modal-close">âœ–</button>
                    <iframe src="${url}" class="user-view-iframe"></iframe>
                </div>
            `;
            
            document.body.appendChild(modalContainer);
            
            //#æ·»åŠ æ¨¡æ€çª—å£æ ·å¼
            if (!document.getElementById('modalStyles')) {
                const style = document.createElement('style');
                style.id = 'modalStyles';
                style.textContent = `
                    .modal-container {
                        position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
                        display: flex; justify-content: center; align-items: center; z-index: 9999; animation: fadeIn 0.3s ease;
                    }
                    .modal-content {
                        position: relative; width: ${width || '90%'}; height: ${height || '90%'}; background: rgba(0,21,41,0.95);
                        border: 1px solid rgba(0,228,255,0.3); border-radius: 8px; padding: 20px;
                        box-shadow: 0 0 20px rgba(0,228,255,0.2); animation: slideIn 0.3s ease;
                    }
                    .modal-close {
                        position: absolute; top: 10px; right: 10px; background: transparent; border: none;
                        color: #00e4ff; font-size: 18px; cursor: pointer; z-index: 1; padding: 5px 10px; transition: all 0.3s ease;
                    }
                    .modal-close:hover { transform: scale(1.1); color: #ff4444; }
                    .user-view-iframe { width: 100%; height: 100%; border: none; border-radius: 4px; background: rgba(1,19,38,0.8); }
                    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                    @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                `;
                document.head.appendChild(style);
            }
            
            //#å…³é—­äº‹ä»¶
            modalContainer.querySelector('.modal-close').onclick = () => modalContainer.remove();
            modalContainer.onclick = (e) => { if (e.target === modalContainer) modalContainer.remove(); };
        }

        //#æ¶ˆæ¯é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToMessageView() {
            try {
                const deviceSn = "{{deviceSn}}"; //#ä»URLè·å–deviceSn
                console.log("navigateToMessageView::deviceSn:", deviceSn);
                if (!deviceSn) {
                    showCustomAlert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯', 'error');
                    return;
                }
                
                //#è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                console.log("navigateToMessageView::data:", data);
                console.log("navigateToMessageView::userId (ç²¾ç¡®):", data.userId);
                
                if (data.success && data.orgId && data.userId) {
                    createModalWindow(`/message_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'æ¶ˆæ¯ç®¡ç†', '90%', '90%');
                } else {
                    showCustomAlert('æ— æ³•è·å–ç”¨æˆ·ç»„ç»‡ä¿¡æ¯', 'error');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                showCustomAlert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        //#å‘Šè­¦é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToAlertView() {
            try {
                const deviceSn = "{{deviceSn}}"; //#ä»URLè·å–deviceSn
                if (!deviceSn) {
                    showCustomAlert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯', 'error');
                    return;
                }
                
                //#è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/alert_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'å‘Šè­¦ç®¡ç†', '90%', '90%');
                } else {
                    showCustomAlert('æ— æ³•è·å–ç»„ç»‡ä¿¡æ¯', 'error');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                showCustomAlert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        //#è®¾å¤‡çŠ¶æ€é¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToDeviceView() {
            try {
                const deviceSn = "{{deviceSn}}"; //#ä»URLè·å–deviceSn
                if (!deviceSn) {
                    showCustomAlert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯', 'error');
                    return;
                }
                
                //#è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId) {
                    createModalWindow(`/device_view.html?customerId=${data.orgId}&userId=${data.userId}`, 'è®¾å¤‡ç®¡ç†', '90%', '90%');
                } else {
                    showCustomAlert('æ— æ³•è·å–ç»„ç»‡ä¿¡æ¯', 'error');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                showCustomAlert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        //#å¥åº·ç”»åƒé¢æ¿ç‚¹å‡»è·³è½¬å‡½æ•°
        async function navigateToHealthAnalysis() {
            try {
                const deviceSn = "{{deviceSn}}"; //#ä»URLè·å–deviceSn
                if (!deviceSn) {
                    showCustomAlert('æ— æ³•è·å–è®¾å¤‡ä¿¡æ¯', 'error');
                    return;
                }
                
                //#è°ƒç”¨åç«¯APIè·å–orgIdå’ŒuserId
                const response = await fetch(`/api/device/user_org?deviceSn=${deviceSn}`);
                const data = await response.json();
                
                if (data.success && data.orgId && data.userId) {
                    createModalWindow(`/user_health_data_analysis.html?customerId=${data.orgId}&userId=${data.userId}`, 'å¥åº·æ•°æ®åˆ†æ', '95%', '95%');
                } else {
                    showCustomAlert('æ— æ³•è·å–ç”¨æˆ·ç»„ç»‡ä¿¡æ¯', 'error');
                }
            } catch (error) {
                console.error('è·³è½¬å¤±è´¥:', error);
                showCustomAlert('è·³è½¬å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }
    </script>
   
    <script>
        //#ä¸“ä¸šä»ªè¡¨ç›˜ç³»ç»Ÿ - ä¼ä¸šçº§åŠ¨æ€æ•ˆæœä¼˜åŒ–
        let vitalCharts = {};
        
        function initVitalCharts() {
            //#å¿ƒç‡ä»ªè¡¨ç›˜ - çº¢è‰²ä¸»é¢˜ï¼Œå¿ƒè·³æ•ˆæœ
            if (document.getElementById('heartRateChart')) {
                vitalCharts.heartRate = echarts.init(document.getElementById('heartRateChart'));
                vitalCharts.heartRate.setOption({
                    backgroundColor: 'transparent',
                    series: [{
                        type: 'gauge', radius: '90%', center: ['50%', '55%'], startAngle: 200, endAngle: -20, min: 50, max: 150, splitNumber: 10,
                        itemStyle: {color: '#ff4757'},
                        progress: {show: true, width: 8, itemStyle: {color: {type: 'linear', x: 0, y: 0, x2: 1, y2: 0, colorStops: [{offset: 0, color: '#ff4757'}, {offset: 1, color: '#ff6b6b'}]}}},
                        pointer: {length: '60%', width: 6, itemStyle: {color: '#ff4757', shadowColor: 'rgba(255,71,87,0.8)', shadowBlur: 15}},
                        axisLine: {lineStyle: {width: 8, color: [[0.3, '#ff4757'], [0.7, '#ffaa00'], [1, '#00ff88']]}},
                        axisTick: {distance: -20, splitNumber: 5, lineStyle: {width: 2, color: '#fff'}},
                        splitLine: {distance: -25, length: 12, lineStyle: {width: 3, color: '#fff'}},
                        axisLabel: {distance: -35, color: '#fff', fontSize: 12, fontWeight: 'bold'},
                        anchor: {show: true, showAbove: true, size: 18, itemStyle: {borderWidth: 10, color: '#ff4757', shadowColor: 'rgba(255,71,87,0.8)', shadowBlur: 10}},
                        title: {show: false},
                        detail: {fontSize: 24, color: '#fff', fontWeight: 'bold', formatter: '{value} bpm', offsetCenter: [0, '70%']},
                        data: [{value: 82, name: 'bpm'}]
                    }]
                });
            }

            //#è¡€æ°§ä»ªè¡¨ç›˜ - è“è‰²ä¸»é¢˜ï¼ŒæµåŠ¨æ•ˆæœ
            if (document.getElementById('bloodOxygenChart')) {
                vitalCharts.bloodOxygen = echarts.init(document.getElementById('bloodOxygenChart'));
                vitalCharts.bloodOxygen.setOption({
                    backgroundColor: 'transparent',
                    series: [{
                        type: 'gauge', radius: '90%', center: ['50%', '55%'], startAngle: 200, endAngle: -20, min: 80, max: 100, splitNumber: 8,
                        itemStyle: {color: '#00ccff'},
                        progress: {show: true, width: 8, itemStyle: {color: {type: 'linear', x: 0, y: 0, x2: 1, y2: 0, colorStops: [{offset: 0, color: '#00ccff'}, {offset: 1, color: '#00ff88'}]}}},
                        pointer: {length: '60%', width: 6, itemStyle: {color: '#00ccff', shadowColor: 'rgba(0,204,255,0.8)', shadowBlur: 15}},
                        axisLine: {lineStyle: {width: 8, color: [[0.6, '#ff4757'], [0.9, '#ffaa00'], [1, '#00ff88']]}},
                        axisTick: {distance: -20, splitNumber: 5, lineStyle: {width: 2, color: '#fff'}},
                        splitLine: {distance: -25, length: 12, lineStyle: {width: 3, color: '#fff'}},
                        axisLabel: {distance: -35, color: '#fff', fontSize: 12, fontWeight: 'bold'},
                        anchor: {show: true, showAbove: true, size: 18, itemStyle: {borderWidth: 10, color: '#00ccff', shadowColor: 'rgba(0,204,255,0.8)', shadowBlur: 10}},
                        title: {show: false},
                        detail: {fontSize: 24, color: '#fff', fontWeight: 'bold', formatter: '{value}%', offsetCenter: [0, '70%']},
                        data: [{value: 98, name: '%'}]
                    }]
                });
            }

            //#ä½“æ¸©ä»ªè¡¨ç›˜ - æ©™è‰²ä¸»é¢˜ï¼Œæ¸©åº¦æ•ˆæœ
            if (document.getElementById('temperatureChart')) {
                vitalCharts.temperature = echarts.init(document.getElementById('temperatureChart'));
                vitalCharts.temperature.setOption({
                    backgroundColor: 'transparent',
                    series: [{
                        type: 'gauge', radius: '90%', center: ['50%', '55%'], startAngle: 200, endAngle: -20, min: 35, max: 42, splitNumber: 7,
                        itemStyle: {color: '#ffaa00'},
                        progress: {show: true, width: 8, itemStyle: {color: {type: 'linear', x: 0, y: 0, x2: 1, y2: 0, colorStops: [{offset: 0, color: '#ffaa00'}, {offset: 1, color: '#ff9500'}]}}},
                        pointer: {length: '60%', width: 6, itemStyle: {color: '#ffaa00', shadowColor: 'rgba(255,170,0,0.8)', shadowBlur: 15}},
                        axisLine: {lineStyle: {width: 8, color: [[0.4, '#00ff88'], [0.8, '#ffaa00'], [1, '#ff4757']]}},
                        axisTick: {distance: -20, splitNumber: 5, lineStyle: {width: 2, color: '#fff'}},
                        splitLine: {distance: -25, length: 12, lineStyle: {width: 3, color: '#fff'}},
                        axisLabel: {distance: -35, color: '#fff', fontSize: 12, fontWeight: 'bold', formatter: '{value}Â°'},
                        anchor: {show: true, showAbove: true, size: 18, itemStyle: {borderWidth: 10, color: '#ffaa00', shadowColor: 'rgba(255,170,0,0.8)', shadowBlur: 10}},
                        title: {show: false},
                        detail: {fontSize: 22, color: '#fff', fontWeight: 'bold', formatter: '{value}Â°C', offsetCenter: [0, '70%']},
                        data: [{value: 36.8, name: 'Â°C'}]
                    }]
                });
            }

            //#è¡€å‹åŒä»ªè¡¨ç›˜ - åŒè‰²ä¸»é¢˜ï¼Œä¸“ä¸šç›‘æ§
            if (document.getElementById('pressureChart')) {
                vitalCharts.pressure = echarts.init(document.getElementById('pressureChart'));
                vitalCharts.pressure.setOption({
                    backgroundColor: 'transparent',
                    series: [
                        {
                            type: 'gauge', radius: '45%', center: ['30%', '55%'], startAngle: 225, endAngle: 45, min: 60, max: 160, splitNumber: 5,
                            itemStyle: {color: '#ff6b6b'},
                            progress: {show: true, width: 6, itemStyle: {color: {type: 'linear', x: 0, y: 0, x2: 1, y2: 0, colorStops: [{offset: 0, color: '#ff6b6b'}, {offset: 1, color: '#ff4757'}]}}},
                            pointer: {length: '60%', width: 5, itemStyle: {color: '#ff6b6b', shadowColor: 'rgba(255,107,107,0.8)', shadowBlur: 10}},
                            axisLine: {lineStyle: {width: 6, color: [[0.5, '#00ff88'], [0.8, '#ffaa00'], [1, '#ff4757']]}},
                            axisTick: {distance: -15, splitNumber: 2, lineStyle: {width: 1, color: '#fff'}},
                            splitLine: {distance: -20, length: 8, lineStyle: {width: 2, color: '#fff'}},
                            axisLabel: {distance: -25, color: '#fff', fontSize: 10, fontWeight: 'bold'},
                            anchor: {show: true, showAbove: true, size: 12, itemStyle: {borderWidth: 6, color: '#ff6b6b'}},
                            title: {show: true, color: '#fff', fontSize: 12, offsetCenter: [0, '-80%']},
                            detail: {fontSize: 16, color: '#fff', fontWeight: 'bold', formatter: '{value}', offsetCenter: [0, '60%']},
                            data: [{value: 120, name: 'æ”¶ç¼©å‹'}]
                        },
                        {
                            type: 'gauge', radius: '45%', center: ['70%', '55%'], startAngle: 225, endAngle: 45, min: 40, max: 100, splitNumber: 4,
                            itemStyle: {color: '#4ecdc4'},
                            progress: {show: true, width: 6, itemStyle: {color: {type: 'linear', x: 0, y: 0, x2: 1, y2: 0, colorStops: [{offset: 0, color: '#4ecdc4'}, {offset: 1, color: '#00ff88'}]}}},
                            pointer: {length: '60%', width: 5, itemStyle: {color: '#4ecdc4', shadowColor: 'rgba(78,205,196,0.8)', shadowBlur: 10}},
                            axisLine: {lineStyle: {width: 6, color: [[0.6, '#00ff88'], [0.9, '#ffaa00'], [1, '#ff4757']]}},
                            axisTick: {distance: -15, splitNumber: 2, lineStyle: {width: 1, color: '#fff'}},
                            splitLine: {distance: -20, length: 8, lineStyle: {width: 2, color: '#fff'}},
                            axisLabel: {distance: -25, color: '#fff', fontSize: 10, fontWeight: 'bold'},
                            anchor: {show: true, showAbove: true, size: 12, itemStyle: {borderWidth: 6, color: '#4ecdc4'}},
                            title: {show: true, color: '#fff', fontSize: 12, offsetCenter: [0, '-80%']},
                            detail: {fontSize: 16, color: '#fff', fontWeight: 'bold', formatter: '{value}', offsetCenter: [0, '60%']},
                            data: [{value: 80, name: 'èˆ’å¼ å‹'}]
                        }
                    ]
                });
            }
            
            console.log('âœ… ä¸“ä¸šä»ªè¡¨ç›˜åˆå§‹åŒ–å®Œæˆ');
        }

        //#æ›´æ–°ä»ªè¡¨ç›˜æ•°æ®å’ŒçŠ¶æ€æŒ‰é’®æ˜¾ç¤º
        function updateVitalDisplays(heartRate, bloodOxygen, pressureHigh, pressureLow, temperature) {
            //#æ›´æ–°æ•°å€¼å åŠ æ˜¾ç¤º
            document.getElementById('heartRateValue').textContent = heartRate;
            document.getElementById('bloodOxygenValue').textContent = bloodOxygen + '%';
            document.getElementById('pressureValue').textContent = `${pressureHigh}/${pressureLow}`;
            document.getElementById('temperatureValue').textContent = temperature.toFixed(1) + 'Â°C';
            
            //#æ›´æ–°ä»ªè¡¨ç›˜åŠ¨æ€æ•ˆæœ
            if (vitalCharts.heartRate) {
                vitalCharts.heartRate.setOption({
                    series: [{
                        data: [{value: heartRate}],
                        animationDuration: 1000,
                        animationEasing: 'cubicOut'
                    }]
                });
            }
            
            if (vitalCharts.bloodOxygen) {
                vitalCharts.bloodOxygen.setOption({
                    series: [{
                        data: [{value: bloodOxygen}],
                        animationDuration: 1200,
                        animationEasing: 'elasticOut'
                    }]
                });
            }
            
            if (vitalCharts.temperature) {
                vitalCharts.temperature.setOption({
                    series: [{
                        data: [{value: temperature}],
                        animationDuration: 1500,
                        animationEasing: 'bounceOut'
                    }]
                });
            }
            
            if (vitalCharts.pressure) {
                vitalCharts.pressure.setOption({
                    series: [
                        {data: [{value: pressureHigh}], animationDuration: 1000},
                        {data: [{value: pressureLow}], animationDuration: 1000}
                    ]
                });
            }

            //#æ›´æ–°çŠ¶æ€æŒ‰é’®æ˜¾ç¤ºæ•°å€¼å’ŒçŠ¶æ€
            updateVitalStatusButtons(heartRate, bloodOxygen, temperature, pressureHigh, pressureLow);
        }

        //#æ›´æ–°çŠ¶æ€æŒ‰é’®æ˜¾ç¤ºæ•°å€¼å’ŒçŠ¶æ€
        function updateVitalStatusButtons(heartRate, bloodOxygen, temperature, pressureHigh, pressureLow) {
            const getStatusInfo = (type, value) => {
                const ranges = {
                    heartRate: {min: 60, max: 100, unit: 'bpm'},
                    bloodOxygen: {min: 95, max: 100, unit: '%'},
                    temperature: {min: 36.3, max: 37.2, unit: 'Â°C'},
                    bloodPressure: {min: 90, max: 140, unit: 'mmHg'}
                };
                
                const range = ranges[type];
                if (!range) return {text: 'æ­£å¸¸', level: 'normal'};
                
                if (value >= range.min && value <= range.max) {
                    return {text: 'æ­£å¸¸', level: 'normal'};
                } else if (value < range.min) {
                    return {text: 'åä½', level: 'low'};
                } else {
                    return {text: 'åé«˜', level: 'high'};
                }
            };

            //#æ›´æ–°çŠ¶æ€æŒ‰é’®æ˜¾ç¤º
            const updateButton = (elementId, value, unit, statusInfo) => {
                const el = document.getElementById(elementId);
                if (el) {
                    el.textContent = `${value}${unit} | ${statusInfo.text}`;
                    //#æ ¹æ®çŠ¶æ€è®¾ç½®æ ·å¼å’ŒåŠ¨ç”»
                    if (statusInfo.level === 'normal') {
                        el.style.background = 'linear-gradient(45deg, #00ff88, #00ccff)';
                        el.style.animation = 'pulse 2s infinite';
                    } else if (statusInfo.level === 'low') {
                        el.style.background = 'linear-gradient(45deg, #ffaa00, #ff9500)';
                        el.style.animation = 'glow 1.5s infinite';
                    } else {
                        el.style.background = 'linear-gradient(45deg, #ff4757, #ff6b6b)';
                        el.style.animation = 'heartbeat 1s infinite';
                    }
                }
            };

            updateButton('heartRateStatus', heartRate, ' bpm', getStatusInfo('heartRate', heartRate));
            updateButton('bloodOxygenStatus', bloodOxygen, '%', getStatusInfo('bloodOxygen', bloodOxygen));
            updateButton('temperatureStatus', temperature.toFixed(1), 'Â°C', getStatusInfo('temperature', temperature));
            updateButton('pressureStatus', `${pressureHigh}/${pressureLow}`, ' mmHg', getStatusInfo('bloodPressure', pressureHigh));
        }

        //#å¢å¼ºåŸæœ‰temHumå‡½æ•°
        const originalTemHum = window.temHum;
        window.temHum = function(heartRate, bloodOxygen, pressureHigh, pressureLow, temperature) {
            //#ä¿æŒåŸæœ‰åŠŸèƒ½
            if (originalTemHum && typeof originalTemHum === 'function') {
                originalTemHum(heartRate, bloodOxygen, pressureHigh, pressureLow, temperature);
            }
            
            //#å¢å¼ºä¸“ä¸šä»ªè¡¨ç›˜æ˜¾ç¤º
            const safeValues = {
                heartRate: Math.max(50, Math.min(150, heartRate || 82)),
                bloodOxygen: Math.max(80, Math.min(100, bloodOxygen || 98)),
                pressureHigh: Math.max(60, Math.min(200, pressureHigh || 120)),
                pressureLow: Math.max(40, Math.min(120, pressureLow || 80)),
                temperature: Math.max(35, Math.min(42, temperature || 36.8))
            };
            
            updateVitalDisplays(safeValues.heartRate, safeValues.bloodOxygen, safeValues.pressureHigh, safeValues.pressureLow, safeValues.temperature);
        };

        //#é¡µé¢åˆå§‹åŒ–
        $(document).ready(() => {
            setTimeout(() => {
                if (typeof echarts !== 'undefined') {
                    initVitalCharts();
                    initDeviceHistoryChart(); //#åˆå§‹åŒ–è®¾å¤‡å†å²è®°å½•å›¾è¡¨
                    //#åˆå§‹åŒ–é»˜è®¤æ•°æ®
                    updateVitalDisplays(82, 98, 120, 80, 36.8);
                    console.log('ğŸ¯ ä¼ä¸šçº§ä¸“ä¸šä»ªè¡¨ç›˜ç³»ç»Ÿå¯åŠ¨å®Œæˆ');
                    
                    //#å®šæ—¶åˆ·æ–°æ•ˆæœ
                    setInterval(() => {
                        Object.values(vitalCharts).forEach(chart => {
                            if (chart && chart.resize) chart.resize();
                        });
                        
                        //#åˆ·æ–°å†å²è®°å½•å›¾è¡¨
                        if (deviceHistoryChart && deviceHistoryChart.resize) {
                            deviceHistoryChart.resize();
                        }
                    }, 5000);
                } else {
                    console.error('âŒ EChartsåº“åŠ è½½å¤±è´¥ï¼Œä»ªè¡¨ç›˜æ— æ³•åˆå§‹åŒ–');
                }
                
                //#åŠ è½½ä¸ªäººç»Ÿè®¡æ•°æ®
                loadPersonalStatistics();
                
                //#å®šæ—¶åˆ·æ–°ä¸ªäººç»Ÿè®¡æ•°æ®å’Œå†å²è®°å½•(30ç§’)
                setInterval(() => {
                    loadPersonalStatistics();
                    loadDeviceHistory(); //#å®šæ—¶åˆ·æ–°å†å²è®°å½•
                }, 30000);
                
            }, 1200);
        });
    </script>

    <script>
        //#è·å–ä¸ªäººç»Ÿè®¡æ•°æ® - ä½¿ç”¨ç»Ÿä¸€APIæ¥å£
        function loadPersonalStatistics() {
            //#è®¾ç½®å½“å‰æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0]; //#ä½¿ç”¨APIæ ‡å‡†æ—¥æœŸæ ¼å¼
            document.getElementById('personalStatsDate').textContent = new Date().toLocaleDateString('zh-CN');
            
            const customerId = '{{ customerId }}' || '1'; //#ä»æ¨¡æ¿è·å–å®¢æˆ·ID
            const deviceSn = '{{ deviceSn }}' || 'CRFTQ23409001890'; //#ä»æ¨¡æ¿è·å–è®¾å¤‡åºåˆ—å·
            
            //#è°ƒç”¨ç»Ÿä¸€çš„ç»Ÿè®¡æ¦‚è§ˆAPI
            fetch(`/api/statistics/overview?orgId=${customerId}&deviceSn=${deviceSn}&date=${today}`)
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    const data = result.data;
                    console.log("å®æ—¶ç»Ÿè®¡æ•°æ®:", data);
                    
                    //#æ›´æ–°ç»Ÿè®¡æ•°å€¼ - ä½¿ç”¨APIæ ‡å‡†å­—æ®µæ˜ å°„
                    document.getElementById('personalHealthData').textContent = formatNumber(data.health_count || 0);
                    document.getElementById('personalAlerts').textContent = formatNumber(data.alert_count || 0);
                    document.getElementById('personalDevice').textContent = (data.active_devices || 0) + 'å°';
                    document.getElementById('personalMessages').textContent = formatNumber(data.message_count || 0);
                    
                    //#è®¡ç®—å¥åº·è¯„åˆ†(åŸºäºç»Ÿè®¡æ•°æ®)
                    const healthScore = calculatePersonalHealthScore(data);
                    document.getElementById('personalHealthScore').textContent = healthScore;
                    updateHealthStatus(healthScore);
                    
                    //#è·å–è®¾å¤‡è¯¦ç»†ä¿¡æ¯ç”¨äºçŠ¶æ€æ˜¾ç¤º
                    loadDeviceStatusInfo();
                    
                    //#æ·»åŠ æ•°æ®æ›´æ–°åŠ¨ç”»
                    animatePersonalStats();
                    
                    console.log('âœ… å®æ—¶ç»Ÿè®¡æ•°æ®å·²æ›´æ–°:', {
                        health_count: data.health_count,
                        alert_count: data.alert_count,
                        active_devices: data.active_devices,
                        message_count: data.message_count
                    });
                } else {
                    console.warn('ç»Ÿè®¡æ•°æ®è·å–å¤±è´¥:', result.message);
                    showPersonalErrorState();
                }
            })
            .catch(error => {
                console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                showPersonalErrorState();
            });
        }

        //#æ ¼å¼åŒ–æ•°å­—æ˜¾ç¤º
        function formatNumber(num) {
            if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;
            return num.toString();
        }

        //#æ›´æ–°ä¸ªäººè¶‹åŠ¿æ˜¾ç¤º
        function updatePersonalTrends(data) {
            const trends = {
                health: data.health_trend || '+5%',
                alerts: data.alert_trend || '+3%',
                device: data.device_trend || '+0%',
                messages: data.message_trend || '+8%'
            };
            
            document.getElementById('personalHealthTrend').textContent = trends.health;
            document.getElementById('personalAlertsTrend').textContent = trends.alerts;
            document.getElementById('personalDeviceTrend').textContent = trends.device;
            document.getElementById('personalMessagesTrend').textContent = trends.messages;
            
            //#è®¾ç½®è¶‹åŠ¿é¢œè‰²
            Object.entries(trends).forEach(([key, value]) => {
                const element = document.getElementById(`personal${key.charAt(0).toUpperCase() + key.slice(1)}Trend`);
                if (element) {
                    element.className = value.startsWith('+') ? 'stat-trend trend-up' : 'stat-trend trend-down';
                }
            });
        }

        //#è·å–è®¾å¤‡çŠ¶æ€è¯¦ç»†ä¿¡æ¯ - ç”¨äºçŠ¶æ€ç¯æ˜¾ç¤º
        function loadDeviceStatusInfo() {
            const deviceSn = '{{ deviceSn }}' || 'CRFTQ23409001890'; //#è®¾å¤‡åºåˆ—å·
            
            fetch(`./get_personal_info?deviceSn=${deviceSn}`)
            .then(response => response.json())
            .then(result => {
                if (result.success && result.data) {
                    //#æ›´æ–°è®¾å¤‡çŠ¶æ€æ–‡å­—è¯´æ˜
                    updateDeviceStatusText(result.data);
                }
            })
            .catch(error => {
                console.warn('è·å–è®¾å¤‡çŠ¶æ€è¯¦æƒ…å¤±è´¥:', error);
            });
        }



        //#è®¡ç®—ä¸ªäººå¥åº·è¯„åˆ† - åŸºäºç»Ÿè®¡æ•°æ®
        function calculatePersonalHealthScore(data) {
            let baseScore = 95;
            
            //#æ ¹æ®å‘Šè­¦æ•°é‡å‡åˆ†
            baseScore -= Math.min((data.alert_count || 0) * 2, 30);
            
            //#æ ¹æ®æ´»è·ƒè®¾å¤‡æ•°è°ƒæ•´
            if ((data.active_devices || 0) === 0) {
                baseScore -= 15;
            }
            
            //#æ ¹æ®æ¶ˆæ¯æ•°é‡å¾®è°ƒ
            baseScore -= Math.min((data.message_count || 0) * 0.3, 10);
            
            return Math.max(60, Math.min(100, Math.round(baseScore)));
        }

        //#æ›´æ–°å¥åº·çŠ¶æ€æ˜¾ç¤º
        function updateHealthStatus(score) {
            const statusElement = document.querySelector('.status-indicator');
            const scoreElement = document.getElementById('personalHealthScore');
            
            if (score >= 90) {
                statusElement.style.background = '#00ff88';
                scoreElement.style.color = '#00ff88';
                scoreElement.style.textShadow = '0 0 15px rgba(0, 255, 136, 0.5)';
            } else if (score >= 70) {
                statusElement.style.background = '#ffaa00';
                scoreElement.style.color = '#ffaa00';
                scoreElement.style.textShadow = '0 0 15px rgba(255, 170, 0, 0.5)';
            } else {
                statusElement.style.background = '#ff4757';
                scoreElement.style.color = '#ff4757';
                scoreElement.style.textShadow = '0 0 15px rgba(255, 71, 87, 0.5)';
            }
        }

        //#åŠ¨ç”»æ•ˆæœ
        function animatePersonalStats() {
            const cards = document.querySelectorAll('.stat-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.transform = 'scale(1)';
                    }, 200);
                }, index * 100);
            });
        }

        //#é”™è¯¯çŠ¶æ€æ˜¾ç¤º
        function showPersonalErrorState() {
            const errorData = {
                health_count: '--',
                alert_count: '--',
                device_status: 'UNKNOWN',
                message_count: '--'
            };
            
            document.getElementById('personalHealthData').textContent = '--';
            document.getElementById('personalAlerts').textContent = '--';
            document.getElementById('personalDevice').textContent = '--';
            document.getElementById('personalMessages').textContent = '--';
            document.getElementById('personalHealthScore').textContent = '--';
        }

        //#è®¾å¤‡å†å²è®°å½•å›¾è¡¨ç®¡ç†
        let deviceHistoryChart = null;
        
        //#åˆå§‹åŒ–è®¾å¤‡å†å²è®°å½•å›¾è¡¨
        function initDeviceHistoryChart() {
            const chartContainer = document.getElementById('deviceHistoryChart');
            if (!chartContainer || !echarts) {
                console.error('å†å²è®°å½•å›¾è¡¨å®¹å™¨æˆ–EChartsæœªæ‰¾åˆ°');
                return;
            }
            
            deviceHistoryChart = echarts.init(chartContainer);
            
            //#åˆå§‹åŒ–å›¾è¡¨ï¼Œä¸æ˜¾ç¤ºæ–‡å­—ï¼Œç­‰å¾…æ•°æ®åŠ è½½
            const defaultOption = {
                backgroundColor: 'transparent',
                grid: { left: '12%', right: '12%', top: '25%', bottom: '15%' },
                xAxis: { 
                    type: 'category',
                    data: [],
                    axisLabel: { color: '#7ecfff', fontSize: 8 },
                    axisLine: { lineStyle: { color: '#333' } }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'ç”µé‡%',
                        axisLabel: { color: '#7ecfff', fontSize: 8 },
                        splitLine: { lineStyle: { color: 'rgba(0,228,255,0.1)' } }
                    },
                    {
                        type: 'value',
                        name: 'çŠ¶æ€',
                        max: 1,
                        axisLabel: { color: '#7ecfff', fontSize: 8 }
                    }
                ],
                series: []
            };
            
            deviceHistoryChart.setOption(defaultOption);
            
            //#åŠ è½½è®¾å¤‡å†å²æ•°æ®
            loadDeviceHistory();
        }
        
        //#åŠ è½½è®¾å¤‡å†å²æ•°æ®
        function loadDeviceHistory() {
            const deviceSn = '{{ deviceSn }}' || 'CRFTQ23409001890'; //#ä»æ¨¡æ¿è·å–è®¾å¤‡åºåˆ—å·
            console.log('æ­£åœ¨åŠ è½½è®¾å¤‡å†å²æ•°æ®ï¼Œè®¾å¤‡åºåˆ—å·:', deviceSn);
            
            fetch(`/api/device/history/timeline?serial_number=${deviceSn}&limit=60`)
            .then(response => response.json())
            .then(result => {
                console.log('è®¾å¤‡å†å²æ•°æ®APIå“åº”:', result);
                if (result.status === 'success' && result.data.timeline.length > 0) {
                    console.log('æ‰¾åˆ°å†å²æ•°æ®ï¼Œæ•°æ®æ¡æ•°:', result.data.timeline.length);
                    renderDeviceHistoryChart(result.data);
                } else {
                    console.warn('è®¾å¤‡å†å²æ•°æ®ä¸ºç©º:', result.message || 'æ— æ•°æ®');
                    showEmptyHistoryChart();
                }
            })
            .catch(error => {
                console.error('è·å–è®¾å¤‡å†å²æ•°æ®å¤±è´¥:', error);
                showEmptyHistoryChart();
            });
        }
        
        //#æ¸²æŸ“è®¾å¤‡å†å²è®°å½•å›¾è¡¨
        function renderDeviceHistoryChart(data) {
            if (!deviceHistoryChart) return;
            
            const timeline = data.timeline;
            const times = timeline.map(item => item.timestamp.split(' ')[1]); //#åªæ˜¾ç¤ºæ—¶é—´éƒ¨åˆ†
            const batteryLevels = timeline.map(item => item.battery_level);
            const wearableStatus = timeline.map(item => item.wearable_status === 'WORN' ? 1 : 0);
            
            const option = {
                backgroundColor: 'transparent',
                grid: { left: '12%', right: '12%', top: '25%', bottom: '15%' }, //#ç´§å‡‘å¸ƒå±€
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#00e4ff',
                    textStyle: { color: '#fff', fontSize: 9 },
                    formatter: function(params) {
                        let html = `<div style="font-size:9px;">æ—¶é—´: ${params[0].axisValue}</div>`;
                        params.forEach(param => {
                            if (param.seriesName === 'ç”µé‡') {
                                html += `<div style="color:#00ff88;">ğŸ”‹ ç”µé‡: ${param.value}%</div>`;
                            } else if (param.seriesName === 'ä½©æˆ´çŠ¶æ€') {
                                html += `<div style="color:#ff6b6b;">ğŸ‘¤ ${param.value === 1 ? 'å·²ä½©æˆ´' : 'æœªä½©æˆ´'}</div>`;
                            }
                        });
                        return html;
                    }
                },
                legend: {
                    data: ['ç”µé‡', 'ä½©æˆ´çŠ¶æ€'],
                    textStyle: { color: '#ccc', fontSize: 8 },
                    top: 0,
                    itemGap: 10
                },
                xAxis: {
                    type: 'category',
                    data: times,
                    axisLine: { lineStyle: { color: '#444' } },
                    axisLabel: { 
                        color: '#ccc', 
                        fontSize: 7,
                        interval: Math.max(Math.floor(times.length / 4), 1) //#æ˜¾ç¤º4ä¸ªæ ‡ç­¾
                    }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: 'ç”µé‡',
                        min: 0,
                        max: 100,
                        axisLine: { lineStyle: { color: '#444' } },
                        axisLabel: { color: '#ccc', fontSize: 7 },
                        nameTextStyle: { color: '#ccc', fontSize: 7 },
                        splitLine: { show: false }
                    },
                    {
                        type: 'value',
                        name: 'ä½©æˆ´',
                        min: 0,
                        max: 1,
                        axisLine: { lineStyle: { color: '#444' } },
                        axisLabel: { 
                            color: '#ccc', 
                            fontSize: 7,
                            formatter: function(value) {
                                return value === 1 ? 'æˆ´' : 'å¦';
                            }
                        },
                        nameTextStyle: { color: '#ccc', fontSize: 7 },
                        splitLine: { show: false }
                    }
                ],
                series: [
                    {
                        name: 'ç”µé‡',
                        type: 'line',
                        yAxisIndex: 0,
                        data: batteryLevels,
                        smooth: true,
                        lineStyle: { color: '#00ff88', width: 1.5 },
                        itemStyle: { color: '#00ff88' },
                        symbolSize: 3,
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(0, 255, 136, 0.2)' },
                                    { offset: 1, color: 'rgba(0, 255, 136, 0.05)' }
                                ]
                            }
                        }
                    },
                    {
                        name: 'ä½©æˆ´çŠ¶æ€',
                        type: 'line',
                        yAxisIndex: 1,
                        data: wearableStatus,
                        step: 'end',
                        lineStyle: { color: '#ff6b6b', width: 1.5 },
                        itemStyle: { color: '#ff6b6b' },
                        symbolSize: 3
                    }
                ]
            };
            
            deviceHistoryChart.setOption(option);
            console.log('âœ… è®¾å¤‡å†å²è®°å½•å›¾è¡¨å·²æ›´æ–°(ç´§å‡‘æ¨¡å¼)');
        }
        
        //#æ˜¾ç¤ºç©ºæ•°æ®å›¾è¡¨ - ä»…åœ¨ç¡®å®æ— æ•°æ®æ—¶æ˜¾ç¤º
        function showEmptyHistoryChart() {
            if (!deviceHistoryChart) return;
            
            const emptyOption = {
                backgroundColor: 'transparent',
                title: {
                    text: 'æš‚æ— å†å²æ•°æ®',
                    subtext: 'æœ€è¿‘60æ¡è®°å½•ä¸ºç©º',
                    textStyle: { color: '#666', fontSize: 11 },
                    subtextStyle: { color: '#444', fontSize: 9 },
                    left: 'center',
                    top: 'middle'
                },
                grid: { show: false },
                xAxis: { show: false },
                yAxis: { show: false },
                series: []
            };
            
            deviceHistoryChart.setOption(emptyOption);
        }
        
        //#åœ¨é¡µé¢åˆå§‹åŒ–æ—¶æ·»åŠ å†å²è®°å½•å›¾è¡¨åˆå§‹åŒ–
        $(document).ready(() => {
            setTimeout(() => {
                if (typeof echarts !== 'undefined') {
                    initVitalCharts();
                    initDeviceHistoryChart(); //#åˆå§‹åŒ–è®¾å¤‡å†å²è®°å½•å›¾è¡¨
                    
                    //#åˆå§‹åŒ–é»˜è®¤æ•°æ®
                    updateVitalDisplays(82, 98, 120, 80, 36.8);
                    console.log('ğŸ¯ ä¼ä¸šçº§ä¸“ä¸šä»ªè¡¨ç›˜ç³»ç»Ÿå¯åŠ¨å®Œæˆ');
                    
                    //#å®šæ—¶åˆ·æ–°æ•ˆæœ
                    setInterval(() => {
                        Object.values(vitalCharts).forEach(chart => {
                            if (chart && chart.resize) chart.resize();
                        });
                        
                        //#åˆ·æ–°å†å²è®°å½•å›¾è¡¨
                        if (deviceHistoryChart && deviceHistoryChart.resize) {
                            deviceHistoryChart.resize();
                        }
                    }, 5000);
                } else {
                    console.error('âŒ EChartsåº“åŠ è½½å¤±è´¥ï¼Œä»ªè¡¨ç›˜æ— æ³•åˆå§‹åŒ–');
                }
                
                //#åŠ è½½ä¸ªäººç»Ÿè®¡æ•°æ®
                loadPersonalStatistics();
                
                //#å®šæ—¶åˆ·æ–°ä¸ªäººç»Ÿè®¡æ•°æ®å’Œå†å²è®°å½•(30ç§’)
                setInterval(() => {
                    loadPersonalStatistics();
                    loadDeviceHistory(); //#å®šæ—¶åˆ·æ–°å†å²è®°å½•
                }, 30000);
                
            }, 1200);
        });
    </script>

    <script>
        // å…¨å±€é›·è¾¾å›¾å˜é‡
        let globalWindChart = null;
        
        // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´é›·è¾¾å›¾å¤§å°
        window.addEventListener('resize', function() {
            if (globalWindChart) {
                setTimeout(() => {
                    globalWindChart.resize();
                    console.log('é›·è¾¾å›¾å·²é‡æ–°è°ƒæ•´å¤§å°');
                }, 100);
            }
        });
        
        // åœ¨é›·è¾¾å›¾åˆå§‹åŒ–æ—¶ä¿å­˜åˆ°å…¨å±€å˜é‡
        function setGlobalWindChart(chart) {
            globalWindChart = chart;
        }
        
        //#å‘Šè­¦å¤„ç†å‡½æ•° - ç»Ÿä¸€AJAXå°è£…
        function handleAlert(alertId) {
            fetch(`./dealAlert?alertId=${alertId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('å‘Šè­¦å¤„ç†æˆåŠŸ:', data);
                        showCustomAlert(data.message, () => {
                            location.reload();
                        });
                    } else {
                        console.error('å‘Šè­¦å¤„ç†å¤±è´¥:', data.message);
                        showCustomAlert('å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•', null);
                    }
                })
                .catch(error => {
                    console.error('å‘Šè­¦å¤„ç†å¼‚å¸¸:', error);
                    showCustomAlert('å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•', null);
                });
        }

        //#è‡ªå®šä¹‰å¼¹å‡ºæ¡†å‡½æ•°
        function showCustomAlert(message, callback) {
            //#åˆ›å»ºé®ç½©å±‚
            const overlay = document.createElement('div');
            overlay.className = 'custom-alert-overlay';
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(2px);
                z-index: 9999; animation: overlayFadeIn 0.3s ease;
            `;
            document.body.appendChild(overlay);

            //#åˆ›å»ºå¼¹å‡ºæ¡†
            const alertBox = document.createElement('div');
            alertBox.className = 'custom-alert';
            alertBox.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(0, 21, 41, 0.95); border: 1px solid rgba(0, 228, 255, 0.3);
                border-radius: 8px; padding: 20px; min-width: 300px;
                box-shadow: 0 0 20px rgba(0, 228, 255, 0.2);
                backdrop-filter: blur(10px); z-index: 10000;
                animation: alertFadeIn 0.3s ease;
            `;
            alertBox.innerHTML = `
                <div style="color: #fff; font-size: 16px; margin-bottom: 20px; text-align: center;">${message}</div>
                <div style="text-align: center;">
                    <button style="background: rgba(0, 228, 255, 0.2); border: 1px solid rgba(0, 228, 255, 0.4);
                                   color: #00e4ff; padding: 8px 20px; border-radius: 4px; cursor: pointer;
                                   transition: all 0.3s ease;" onmouseover="this.style.background='rgba(0, 228, 255, 0.3)'"
                                   onmouseout="this.style.background='rgba(0, 228, 255, 0.2)'">ç¡®å®š</button>
                </div>
            `;
            document.body.appendChild(alertBox);

            //#æ·»åŠ ç¡®å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            const confirmButton = alertBox.querySelector('button');
            confirmButton.onclick = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(alertBox);
                if (callback) callback();
            };
        }
    </script>

</body>

</html>