<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generated by Codia AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bigscreen/alert.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
    <style>
      body {
        font-family: 'Inter', sans-serif; /* 字体 */
        background-color: rgba(30, 30, 30, 0.1); /* 背景色 with 80% opacity */
        color: #ffffff; /* 文本颜色 */
        margin: 0;
        padding: 0;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 0.9em; /* 设置表格字体大小 */
        min-width: 400px;
        background-color: #2e2e2e;
        border-radius: 8px; /* 圆角 */
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
    }
    .table-header {
      display: contents; /* 与子元素共享网格布局 */
      font-weight: bold;
      color: #66ccff; /* 表头颜色 */
      padding: 8px 0;
    }
    
    thead tr {
        background-color: #3e3e3e; /* 表头背景 */
        font-size: 1em; /* 表头字体大小 */
        text-transform: uppercase; /* 表头大写 */
        letter-spacing: 0.03em;
        color: #ffffff;
    }
    
    th, td {
        padding: 15px; /* 增加间距 */
        text-align: left;
        font-size: 0.95em; /* 单元格字体大小 */
    }
    
    tbody tr {
        border-bottom: 1px solid #444; /* 添加底部边框 */
        transition: all 0.2s ease; /* 鼠标悬停效果 */
    }
    
    tbody tr:nth-of-type(even) {
        background-color: #3a3a3a; /* 偶数行颜色 */
    }
    
    tbody tr:hover {
        background-color: #454545; /* 悬停高亮颜色 */
        transform: scale(1.01); /* 微小放大效果 */
    }
    
    .badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 12px; /* 调整圆角 */
        color: #fff;
        font-weight: bold;
        font-size: 0.85em; /* 调整徽章字体大小 */
    }
    
    .badge.active {
        background-color: #28a745; /* 绿色徽章 */
    }
    
    .badge.danger {
        background-color: #dc3545; /* 红色徽章 */
    }
    
    .badge.pending {
        background-color: #ffc107; /* 黄色徽章 */
    }
    .location-container {
      display: flex;
      align-items: center;
      padding: 8px 0; /* 控制上下间距 */
      color: #ffffff;
      font-family: 'Inter', sans-serif;
      background-color: transparent; /* 背景透明 */
    }
    
    .location-icon {
      font-size: 20px; /* 图标大小 */
      margin-right: 8px; /* 图标与内容间距 */
    }
    
    .location-details {
      display: flex;
      flex-direction: column; /* 垂直排列纬度和经度 */
    }
    
    .latitude,
    .longitude {
      font-size: 14px; /* 字体大小 */
      line-height: 1.5;
    }
    
    .value {
      font-weight: bold; /* 突出数值 */
      color: #66ccff; /* 数值颜色 */
    }
    .phone-time-container {
      width: 100%;
      background-color: transparent; /* 背景透明 */
      padding: 10px 0; /* 内边距 */
    }
    
    .phone-time-item {
      display: flex;
      align-items: center;
      padding: 8px 16px; /* 控制每条记录的内边距 */
      font-family: 'Inter', sans-serif;
      color: #ffffff; /* 文字颜色 */
      font-size: 14px;
    }
    
    .icon {
      font-size: 18px;
      margin-right: 8px; /* 图标与文字的间距 */
      color: #66ccff; /* 图标颜色 */
    }
    
    .phone-number {
      font-weight: bold; /* 突出手机号码 */
      margin-right: 16px; /* 手机号码与时间的间距 */
    }
    
    .timestamp {
      color: #aaaaaa; /* 时间颜色稍微淡一些 */
    }
    
    .divider {
      height: 1px;
      background-color: #444444; /* 分隔线颜色 */
      margin: 4px 16px; /* 分隔线的边距 */
    }
    .phone-number {
      font-weight: bold; /* 手机号码加粗 */
    }
    
    .timestamp {
      color: #aaaaaa; /* 时间颜色更淡 */
    }
    .column {
      padding: 8px 12px; /* 列的内边距 */
      text-align: left; /* 左对齐 */
    }
    
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="cards">
        <div class="table-container" style="max-height: 600px; overflow-y: auto;">
          <table>
            <thead class="table-header">
              <tr>
              
                <th style="width: 20%;">部门用户名</th>
                <th style="width: 10%;">消息类型</th>
                <th style="width: 25%;">消息内容</th>
                <th style="width: 20%;">发送时间</th>
                <th style="width: 20%;">接收时间</th>
              </tr>
            </thead>
            <tbody id="message-container">
              <!-- Alerts will be dynamically inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
 
    <script>
      function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search); // Get query params from the current URL
        return urlParams.get(name); // Get the value of the 'name' parameter
      }

      // Function to fetch alerts from the server
      function fetchMessages(customerId) {
        console.log(`fetchMessages::customerId:${customerId}`);
        
       
        fetch('./get_messages_by_orgIdAndUserId?orgId=' + customerId)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const messageContainer = document.getElementById('message-container');
              messageContainer.innerHTML = ''; // Clear existing content
              console.log("data.messages:", data.data.messages);

              data.data.messages.forEach(message => {
                const messageRow = document.createElement('tr');
                let buttonClass = '';
                let spanClass = '';

                switch (message.message_type.toLowerCase()) {
                  case 'announcement':
                    buttonClass = 'button';
                    spanClass = 'oct';
                    break;
                  case 'warning':
                    buttonClass = 'button-danger';
                    spanClass = 'oct-danger';
                    break;
                  case 'notification':
                    buttonClass = 'button-pending';
                    spanClass = 'oct-pending';
                    break;
                  default:
                    buttonClass = 'status-default'; // Optional: handle unknown types
                    spanClass = 'oct-default';
                }
                messageRow.innerHTML = `
                
                  <td> ${message.department_name}-${message.user_name ? message.user_name : '公告'}</td>
                  
                  
                  <td> 
                    <button class="${buttonClass}">
                      <span class="${spanClass}">${mapMessageType(message.message_type)}</span>
                    </button>
                  </td>
                  <td>${message.message}</div></td>
                      
                  <td><div class="column timestamp"><span class="icon">⏰</span> ${message.sent_time}</div></td>
                  <td><div class="column timestamp"><span class="icon">⏰</span> ${message.received_time}</div></td>
                `;
                messageContainer.appendChild(messageRow);
              });
            } else {
              console.error('Failed to fetch alerts:', data.error);
            }
          })
          .catch(error => console.error('Error fetching alerts:', error));
      }

      // Fetch alerts when the page loads
      window.onload = () => {
        const customerId = getQueryParameter('customerId'); // Extract customerId from URL
        if (customerId) {
          fetchMessages(customerId); // Pass customerId to fetchMessages function
        } else {
          console.error('No customerId found in the URL');
        }
      };
    </script>
    <script>
      function mapSeverityLevel(severityLevel) {
          switch (severityLevel) {
              case 'critical':
                  return '一级';
              case 'high':
                  return '二级';
              case 'medium':
                  return '其他';
              default:
                  return '未知';
          }
      }

      function mapMessageType(messageType) {
          switch (messageType) {
              case 'announcement':
                  return '公告';
              case 'warning':
                  return '警告';
              case 'notification':
                  return '通知';
              case 'task':
                  return '任务管理';
              case 'job':
                  return '作业指引';
              default:
                  return '未知';
          }
      }
      function mapMessageStatus(messageStatus) {
          switch (messageStatus) {
              case 'responded':
                  return '已处理';
              case 'pending':
                  return '未处理';
              case 'closed':
                  return '已关闭';
              default:
                  return '未知';
          }
      }
  </script>
 
    <!-- Generated by Codia AI - https://codia.ai/ -->
  </body>
</html>
