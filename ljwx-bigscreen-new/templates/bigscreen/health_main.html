<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¥åº·å¤§å±</title>
  <style>
    body { margin:0; background:#181c2f; color:#eee; font-family:'Segoe UI','PingFang SC','Microsoft YaHei',Arial,sans-serif;}
    .tab-bar { 
      display:flex; gap:4px; background:linear-gradient(135deg,#232946 0%,#1e1e3f 100%); 
      padding:12px 20px; border-bottom:3px solid #2a2f4a; position:relative;
      box-shadow:0 4px 15px rgba(0,0,0,0.4);
    }
    .tab-bar::before {
      content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,transparent,#00eaff,transparent);
    }
    .tab-btn {
      position:relative; flex:1; max-width:280px; padding:18px 32px; 
      font-size:18px; font-weight:600; color:#b0c4de;
      background:linear-gradient(135deg,rgba(35,41,70,0.8),rgba(30,30,63,0.8));
      border:2px solid rgba(0,234,255,0.2); border-radius:12px; cursor:pointer;
      transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275); outline:none; 
      letter-spacing:1px; overflow:hidden; text-align:center;
      box-shadow:0 4px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    .tab-btn::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(0,234,255,0.2),transparent);
      transition:left 0.6s; z-index:1;
    }
    .tab-btn:hover::before { left:100%; }
    .tab-btn:hover {
      transform:translateY(-2px); color:#00eaff;
      border-color:rgba(0,234,255,0.6);
      box-shadow:0 8px 25px rgba(0,234,255,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    .tab-btn.active {
      background:linear-gradient(135deg,#00eaff,#38f9d7); color:#181c2f; 
      border-color:#00eaff; font-weight:700;
      box-shadow:0 0 30px rgba(0,234,255,0.6), 0 8px 25px rgba(0,234,255,0.4);
      transform:translateY(-3px) scale(1.02);
    }
    .tab-btn.active::before { display:none; }
    .tab-icon {
      display:inline-block; margin-right:8px; font-size:20px;
      text-shadow:0 0 10px currentColor; filter:drop-shadow(0 0 5px currentColor);
    }
    .tab-content { width:100vw; height:calc(100vh - 72px); background:#181c2f; position:relative; }
    iframe { width:100%; height:100%; border:none; background:#181c2f; }
    .loading { 
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); 
      color:#00eaff; font-size:20px; z-index:1000; font-weight:600;
      background:rgba(24,28,47,0.95); padding:25px 50px; border-radius:12px;
      border:2px solid #00eaff; box-shadow:0 0 30px rgba(0,234,255,0.4);
      backdrop-filter:blur(10px); animation:pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%,100% { box-shadow:0 0 30px rgba(0,234,255,0.4); }
      50% { box-shadow:0 0 40px rgba(0,234,255,0.7); }
    }
    .debug-info {
      position:fixed; top:15px; right:15px; background:rgba(0,0,0,0.9);
      color:#0f0; font-size:12px; padding:10px; border-radius:6px; z-index:2000;
      max-width:350px; font-family:monospace; border:1px solid #0f0;
      box-shadow:0 0 15px rgba(0,255,0,0.3);
    }
  </style>
</head>
<body>
  <div class="tab-bar">
    <button class="tab-btn active" data-url="health_table">
      <span class="tab-icon">ğŸ“Š</span>å¥åº·æ•°æ®è¡¨æ ¼
    </button>
    <button class="tab-btn" data-url="health_trends">
      <span class="tab-icon">ğŸ“ˆ</span>å¥åº·è¶‹åŠ¿å›¾
    </button>
    <button class="tab-btn" data-url="health_baseline">
      <span class="tab-icon">ğŸ¯</span>å¥åº·åŸºçº¿åˆ†æ
    </button>
  </div>
  <div class="tab-content">
    <div class="loading" id="loading">æ­£åœ¨åŠ è½½å¥åº·æ•°æ®è¡¨æ ¼...</div>
    <iframe id="mainFrame" src="" style="display:none;"></iframe>
  </div>
  
  <div class="debug-info" id="debugInfo" style="display:none;"></div>
  
  <script>
    console.log('ğŸš€ Health Main é¡µé¢å¼€å§‹åˆå§‹åŒ–');
    
    const params=new URLSearchParams(location.search); //è·å–URLå‚æ•°
    const customerId=params.get('customerId')||params.get('customer_id')||'1';
    const deptId=params.get('deptId')||params.get('orgId')||customerId;
    const userId=params.get('userId')||'';
    const deptName=params.get('deptName')||'';
    const userName=params.get('userName')||'';
    
    const debugInfo=document.getElementById('debugInfo');
    const updateDebug=(msg)=>{
      console.log(msg);
      debugInfo.innerHTML+=new Date().toLocaleTimeString()+': '+msg+'<br>';
      debugInfo.style.display='block';
      setTimeout(()=>debugInfo.style.display='none',5000); //5ç§’åéšè—è°ƒè¯•ä¿¡æ¯
    };
    
    //updateDebug(`å‚æ•°è§£æ: customerId=${customerId}, deptId=${deptId}, userId=${userId}`);
    
    function buildUrl(baseUrl){ //æ„å»ºå®Œæ•´URL
      try{
        const url=new URL(baseUrl,location.origin);
        url.searchParams.set('customerId',customerId);
        url.searchParams.set('deptId',deptId);
        if(userId)url.searchParams.set('userId',userId);
        if(deptName)url.searchParams.set('deptName',deptName);
        if(userName)url.searchParams.set('userName',userName);
        //updateDebug(`æ„å»ºURL: ${url.toString()}`);
        return url.toString();
      }catch(e){
        //updateDebug(`URLæ„å»ºå¤±è´¥: ${e.message}`);
        return baseUrl+'?customerId='+customerId+'&deptId='+deptId;
      }
    }
    
    function showLoading(msg='æ­£åœ¨åŠ è½½...'){
      document.getElementById('loading').textContent=msg;
      document.getElementById('loading').style.display='block';
      document.getElementById('mainFrame').style.display='none';
      //updateDebug(`æ˜¾ç¤ºåŠ è½½çŠ¶æ€: ${msg}`);
    }
    
    function hideLoading(){
      document.getElementById('loading').style.display='none';
      document.getElementById('mainFrame').style.display='block';
      //updateDebug('éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºå†…å®¹');
    }
    
    let loadTimeout;
    function loadTab(url,tabName){ //åŠ è½½æ ‡ç­¾é¡µå†…å®¹
      clearTimeout(loadTimeout);
      showLoading(`æ­£åœ¨åŠ è½½${tabName||url}...`);
      
      const frame=document.getElementById('mainFrame');
      const targetUrl=buildUrl(url);
      
      frame.onload=()=>{
        clearTimeout(loadTimeout);
        hideLoading();
        //updateDebug(`é¡µé¢åŠ è½½æˆåŠŸ: ${url}`);
      };
      
      frame.onerror=()=>{
        clearTimeout(loadTimeout);
        hideLoading();
        //updateDebug(`é¡µé¢åŠ è½½å¤±è´¥: ${url}`);
        alert(`é¡µé¢åŠ è½½å¤±è´¥: ${url}\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•`);
      };
      
      loadTimeout=setTimeout(()=>{ //15ç§’è¶…æ—¶
        //updateDebug(`é¡µé¢åŠ è½½è¶…æ—¶: ${url}`);
        alert(`é¡µé¢åŠ è½½è¶…æ—¶: ${url}\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•`);
      },15000);
      
      //updateDebug(`å¼€å§‹åŠ è½½: ${targetUrl}`);
      frame.src=targetUrl;
    }
    
    const tabs=document.querySelectorAll('.tab-btn'); //ç»‘å®šæ ‡ç­¾é¡µäº‹ä»¶
    tabs.forEach(btn=>{
      btn.onclick=()=>{
        if(btn.classList.contains('active'))return;
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        loadTab(btn.dataset.url,btn.textContent);
      };
    });
    
    //ç¡®ä¿DOMå®Œå…¨åŠ è½½åå†æ‰§è¡Œ
    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded',()=>loadTab('health_table','å¥åº·æ•°æ®è¡¨æ ¼'));
    }else{
      loadTab('health_table','å¥åº·æ•°æ®è¡¨æ ¼'); //ç«‹å³åŠ è½½
    }
    
    //updateDebug('Health Main åˆå§‹åŒ–å®Œæˆ');
  </script>
</body>
</html>
