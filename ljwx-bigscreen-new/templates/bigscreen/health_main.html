<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>健康大屏</title>
  <style>
    body { margin:0; background:#181c2f; color:#eee; font-family:'Segoe UI','PingFang SC','Microsoft YaHei',Arial,sans-serif;}
    .tab-bar { 
      display:flex; gap:4px; background:linear-gradient(135deg,#232946 0%,#1e1e3f 100%); 
      padding:12px 20px; border-bottom:3px solid #2a2f4a; position:relative;
      box-shadow:0 4px 15px rgba(0,0,0,0.4);
    }
    .tab-bar::before {
      content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,transparent,#00eaff,transparent);
    }
    .tab-btn {
      position:relative; flex:1; max-width:280px; padding:18px 32px; 
      font-size:18px; font-weight:600; color:#b0c4de;
      background:linear-gradient(135deg,rgba(35,41,70,0.8),rgba(30,30,63,0.8));
      border:2px solid rgba(0,234,255,0.2); border-radius:12px; cursor:pointer;
      transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275); outline:none; 
      letter-spacing:1px; overflow:hidden; text-align:center;
      box-shadow:0 4px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
    }
    .tab-btn::before {
      content:''; position:absolute; top:0; left:-100%; width:100%; height:100%;
      background:linear-gradient(90deg,transparent,rgba(0,234,255,0.2),transparent);
      transition:left 0.6s; z-index:1;
    }
    .tab-btn:hover::before { left:100%; }
    .tab-btn:hover {
      transform:translateY(-2px); color:#00eaff;
      border-color:rgba(0,234,255,0.6);
      box-shadow:0 8px 25px rgba(0,234,255,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
    }
    .tab-btn.active {
      background:linear-gradient(135deg,#00eaff,#38f9d7); color:#181c2f; 
      border-color:#00eaff; font-weight:700;
      box-shadow:0 0 30px rgba(0,234,255,0.6), 0 8px 25px rgba(0,234,255,0.4);
      transform:translateY(-3px) scale(1.02);
    }
    .tab-btn.active::before { display:none; }
    .tab-icon {
      display:inline-block; margin-right:8px; font-size:20px;
      text-shadow:0 0 10px currentColor; filter:drop-shadow(0 0 5px currentColor);
    }
    .tab-content { width:100vw; height:calc(100vh - 72px); background:#181c2f; position:relative; }
    iframe { width:100%; height:100%; border:none; background:#181c2f; }
    .loading { 
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); 
      color:#00eaff; font-size:20px; z-index:1000; font-weight:600;
      background:rgba(24,28,47,0.95); padding:25px 50px; border-radius:12px;
      border:2px solid #00eaff; box-shadow:0 0 30px rgba(0,234,255,0.4);
      backdrop-filter:blur(10px); animation:pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%,100% { box-shadow:0 0 30px rgba(0,234,255,0.4); }
      50% { box-shadow:0 0 40px rgba(0,234,255,0.7); }
    }
    .debug-info {
      position:fixed; top:15px; right:15px; background:rgba(0,0,0,0.9);
      color:#0f0; font-size:12px; padding:10px; border-radius:6px; z-index:2000;
      max-width:350px; font-family:monospace; border:1px solid #0f0;
      box-shadow:0 0 15px rgba(0,255,0,0.3);
    }
  </style>
</head>
<body>
  <div class="tab-bar">
    <button class="tab-btn active" data-url="health_table">
      <span class="tab-icon">📊</span>健康数据表格
    </button>
    <button class="tab-btn" data-url="health_trends">
      <span class="tab-icon">📈</span>健康趋势图
    </button>
    <button class="tab-btn" data-url="health_baseline">
      <span class="tab-icon">🎯</span>健康基线分析
    </button>
  </div>
  <div class="tab-content">
    <div class="loading" id="loading">正在加载健康数据表格...</div>
    <iframe id="mainFrame" src="" style="display:none;"></iframe>
  </div>
  
  <div class="debug-info" id="debugInfo" style="display:none;"></div>
  
  <script>
    console.log('🚀 Health Main 页面开始初始化');
    
    const params=new URLSearchParams(location.search); //获取URL参数
    const customerId=params.get('customerId')||params.get('customer_id')||'1';
    const deptId=params.get('deptId')||params.get('orgId')||customerId;
    const userId=params.get('userId')||'';
    const deptName=params.get('deptName')||'';
    const userName=params.get('userName')||'';
    
    const debugInfo=document.getElementById('debugInfo');
    const updateDebug=(msg)=>{
      console.log(msg);
      debugInfo.innerHTML+=new Date().toLocaleTimeString()+': '+msg+'<br>';
      debugInfo.style.display='block';
      setTimeout(()=>debugInfo.style.display='none',5000); //5秒后隐藏调试信息
    };
    
    //updateDebug(`参数解析: customerId=${customerId}, deptId=${deptId}, userId=${userId}`);
    
    function buildUrl(baseUrl){ //构建完整URL
      try{
        const url=new URL(baseUrl,location.origin);
        url.searchParams.set('customerId',customerId);
        url.searchParams.set('deptId',deptId);
        if(userId)url.searchParams.set('userId',userId);
        if(deptName)url.searchParams.set('deptName',deptName);
        if(userName)url.searchParams.set('userName',userName);
        //updateDebug(`构建URL: ${url.toString()}`);
        return url.toString();
      }catch(e){
        //updateDebug(`URL构建失败: ${e.message}`);
        return baseUrl+'?customerId='+customerId+'&deptId='+deptId;
      }
    }
    
    function showLoading(msg='正在加载...'){
      document.getElementById('loading').textContent=msg;
      document.getElementById('loading').style.display='block';
      document.getElementById('mainFrame').style.display='none';
      //updateDebug(`显示加载状态: ${msg}`);
    }
    
    function hideLoading(){
      document.getElementById('loading').style.display='none';
      document.getElementById('mainFrame').style.display='block';
      //updateDebug('隐藏加载状态，显示内容');
    }
    
    let loadTimeout;
    function loadTab(url,tabName){ //加载标签页内容
      clearTimeout(loadTimeout);
      showLoading(`正在加载${tabName||url}...`);
      
      const frame=document.getElementById('mainFrame');
      const targetUrl=buildUrl(url);
      
      frame.onload=()=>{
        clearTimeout(loadTimeout);
        hideLoading();
        //updateDebug(`页面加载成功: ${url}`);
      };
      
      frame.onerror=()=>{
        clearTimeout(loadTimeout);
        hideLoading();
        //updateDebug(`页面加载失败: ${url}`);
        alert(`页面加载失败: ${url}\n请检查网络连接或刷新页面重试`);
      };
      
      loadTimeout=setTimeout(()=>{ //15秒超时
        //updateDebug(`页面加载超时: ${url}`);
        alert(`页面加载超时: ${url}\n请检查网络连接或刷新页面重试`);
      },15000);
      
      //updateDebug(`开始加载: ${targetUrl}`);
      frame.src=targetUrl;
    }
    
    const tabs=document.querySelectorAll('.tab-btn'); //绑定标签页事件
    tabs.forEach(btn=>{
      btn.onclick=()=>{
        if(btn.classList.contains('active'))return;
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        loadTab(btn.dataset.url,btn.textContent);
      };
    });
    
    //确保DOM完全加载后再执行
    if(document.readyState==='loading'){
      document.addEventListener('DOMContentLoaded',()=>loadTab('health_table','健康数据表格'));
    }else{
      loadTab('health_table','健康数据表格'); //立即加载
    }
    
    //updateDebug('Health Main 初始化完成');
  </script>
</body>
</html>
