<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generated by Codia AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bigscreen/alert.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/profile-button.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" />
    <style>
      body {
        font-family: 'Inter', sans-serif; /* 字体 */
        background-color: rgba(30, 30, 30, 0.1); /* 背景色 with 80% opacity */
        color: #ffffff; /* 文本颜色 */
        margin: 0;
        padding: 0;
    }
    
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 0.9em; /* 设置表格字体大小 */
        min-width: 400px;
        background-color: #2e2e2e;
        border-radius: 8px; /* 圆角 */
        overflow: hidden;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 添加阴影效果 */
    }
    .table-header {
      display: contents; /* 与子元素共享网格布局 */
      font-weight: bold;
      color: #66ccff; /* 表头颜色 */
      padding: 8px 0;
    }
    
    thead tr {
        background-color: #3e3e3e; /* 表头背景 */
        font-size: 1em; /* 表头字体大小 */
        text-transform: uppercase; /* 表头大写 */
        letter-spacing: 0.03em;
        color: #ffffff;
    }
    
    th, td {
        padding: 15px; /* 增加间距 */
        text-align: left;
        font-size: 0.95em; /* 单元格字体大小 */
    }
    
    tbody tr {
        border-bottom: 1px solid #444; /* 添加底部边框 */
        transition: all 0.2s ease; /* 鼠标悬停效果 */
    }
    
    tbody tr:nth-of-type(even) {
        background-color: #3a3a3a; /* 偶数行颜色 */
    }
    
    tbody tr:hover {
        background-color: #454545; /* 悬停高亮颜色 */
        transform: scale(1.01); /* 微小放大效果 */
    }
    
    .badge {
        display: inline-block;
        padding: 5px 10px;
        border-radius: 12px; /* 调整圆角 */
        color: #fff;
        font-weight: bold;
        font-size: 0.85em; /* 调整徽章字体大小 */
    }
    
    .badge.active {
        background-color: #28a745; /* 绿色徽章 */
    }
    
    .badge.danger {
        background-color: #dc3545; /* 红色徽章 */
    }
    
    .badge.pending {
        background-color: #ffc107; /* 黄色徽章 */
    }
    .location-container {
      display: flex;
      align-items: center;
      padding: 8px 0; /* 控制上下间距 */
      color: #ffffff;
      font-family: 'Inter', sans-serif;
      background-color: transparent; /* 背景透明 */
    }
    
    .location-icon {
      font-size: 20px; /* 图标大小 */
      margin-right: 8px; /* 图标与内容间距 */
    }
    
    .location-details {
      display: flex;
      flex-direction: column; /* 垂直排列纬度和经度 */
    }
    
    .latitude,
    .longitude {
      font-size: 14px; /* 字体大小 */
      line-height: 1.5;
    }
    
    .value {
      font-weight: bold; /* 突出数值 */
      color: #66ccff; /* 数值颜色 */
    }
    .phone-time-container {
      width: 100%;
      background-color: transparent; /* 背景透明 */
      padding: 10px 0; /* 内边距 */
    }
    
    .phone-time-item {
      display: flex;
      align-items: center;
      padding: 8px 16px; /* 控制每条记录的内边距 */
      font-family: 'Inter', sans-serif;
      color: #ffffff; /* 文字颜色 */
      font-size: 14px;
    }
    
    .icon {
      font-size: 18px;
      margin-right: 8px; /* 图标与文字的间距 */
      color: #66ccff; /* 图标颜色 */
    }
    
    .phone-number {
      font-weight: bold; /* 突出手机号码 */
      margin-right: 16px; /* 手机号码与时间的间距 */
    }
    
    .timestamp {
      color: #aaaaaa; /* 时间颜色稍微淡一些 */
    }
    
    .divider {
      height: 1px;
      background-color: #444444; /* 分隔线颜色 */
      margin: 4px 16px; /* 分隔线的边距 */
    }
    .phone-number {
      font-weight: bold; /* 手机号码加粗 */
    }
    
    .timestamp {
      color: #aaaaaa; /* 时间颜色更淡 */
    }
    .column {
      padding: 8px 12px; /* 列的内边距 */
      text-align: left; /* 左对齐 */
    }
    .profile-button a {
      color: #28a745; /* 链接文字为绿色 */
      text-decoration: none;
      font-size: 12px; 
  }
  
  .profile-button a:hover {
      color: #1e7e34; /* 鼠标悬停时，文字变深绿 */
  }
    
    </style>
  </head>
  <body>
    <div class="main-container">
      <div class="cards">
        <div class="table-container" style="max-height: 600px; overflow-y: auto;">
          <table>
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>部门</th>
                <th>用户名</th>
                <th>报警类型</th>
                <th>位置</th>
                <th>时间</th>
                <th>处理</th>
              </tr>
            </thead>
            <tbody id="alerts-container">
              <!-- Alerts will be dynamically inserted here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
 
    <script>
      function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search); // Get query params from the current URL
        return urlParams.get(name); // Get the value of the 'name' parameter
      }

      // Function to fetch alerts from the server
      function fetchAlerts(customerId) {
        fetch('./get_alerts_by_orgIdAndUserId?orgId=' + customerId)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const alertsContainer = document.getElementById('alerts-container');
              alertsContainer.innerHTML = ''; // Clear existing content
              console.log("data:", data.data.alerts);

              // 遍历告警数据
              data.data.alerts.forEach(alert => {
                const alertRow = document.createElement('tr');
                let buttonClass = '';
                let spanClass = '';

                switch (alert.alert_type.toLowerCase()) {  // 改为 alert_type
                  case '心率异常':
                    buttonClass = 'button';
                    spanClass = 'oct';
                    break;
                  case '血压异常':
                    buttonClass = 'button-danger';
                    spanClass = 'oct-danger';
                    break;
                  case '血氧异常':
                    buttonClass = 'button-pending';
                    spanClass = 'oct-pending';
                    break;
                  case '体温异常':
                    buttonClass = 'button-temperature';
                    spanClass = 'oct-temperature';
                    break;
                  case '跌倒告警':
                    buttonClass = 'button-fall';
                    spanClass = 'oct-fall';
                    break;
                  case 'sos告警':
                    buttonClass = 'button-sos';
                    spanClass = 'oct-sos';
                    break;
                  default:
                    buttonClass = 'status-default';
                    spanClass = 'oct-default';
                }
                alertRow.innerHTML = `
                  <td>${alert.alert_id}</td>
                  <td> <div class="simple-68"><div class="image-69"></div><span class="monna-liza-6b">${alert.dept_name}</span></div></td>
                  
                  <td><div class="column phone-number"><span class="icon">⌚</span> ${alert.user_name}</div></td>
                  <td> 
                    <button class="${buttonClass}">
                      <span class="${spanClass}">${alert.alert_type}</span>
                    </button>
                  </td>
                  <td>
                    <div class="location-container">
                      <span class="location-icon">📍</span>
                      <div class="location-details">
                      <div class="latitude">纬度: <span class="value">${alert.latitude || 'N/A'}</span></div>
                      <div class="longitude">经度: <span class="value">${alert.longitude || 'N/A'}</span></div>
                      </div>
                    </div>
                  </td>
                  <td><div class="column timestamp"><span class="icon">⏰</span> ${alert.alert_timestamp}</div></td>
                  <td><button class="profile-button"><a href="./dealAlert?alertId=${alert.alert_id}">一键处理</a></button></td>
                `;
                alertsContainer.appendChild(alertRow);
              });
            } else {
              console.error('Failed to fetch alerts:', data.error);
            }
          })
          .catch(error => console.error('Error fetching alerts:', error));
      }

      // Fetch alerts when the page loads
      window.onload = () => {
        const customerId = getQueryParameter('customerId'); // Extract customerId from URL
        if (customerId) {
          fetchAlerts(customerId); // Pass customerId to fetchAlerts function
        } else {
          console.error('No customerId found in the URL');
        }
      };
    </script>
    <!-- Generated by Codia AI - https://codia.ai/ -->
  </body>
</html>
