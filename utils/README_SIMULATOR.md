# 健康数据模拟器使用指南

## 概述
这个模拟器用于验证大屏的显示效果，支持批量历史数据生成和实时数据上传两种模式。

## 实时模拟模式（推荐用于大屏验证）

### 启动实时模拟
```bash
./utils/simulate_health_data.sh realtime
```

### 功能特点
- **自动获取用户**: 从数据库查询 `org_id=1` 的所有佩戴手表用户
- **双重数据流**: 
  - 健康数据每5秒上传一次
  - 设备信息每20秒上传一次
- **真实模拟**: 
  - 电量随时间自然降低
  - 低电量时触发充电状态
  - 佩戴状态随机变化
  - 数据质量受佩戴状态影响
- **时间相关**: 根据时间段调整健康指标（睡眠/工作/休息）

### 模拟数据特性

#### 健康数据
- **心率**: 睡眠时55±8bpm，工作时75±8bpm，休息时68±8bpm
- **血氧**: 96-100%（未佩戴时可能94-100%）
- **体温**: 36.0-37.5°C随机分布
- **血压**: 收缩压105-140，舒张压65-90
- **步数**: 睡眠时0-50步，其他时段100-800步
- **压力值**: 睡眠时25±12，工作时45±12，休息时35±12

#### 设备信息
- **电量管理**: 初始30-100%，每小时降2%，低于20%时可能充电
- **佩戴状态**: 随机变化，影响数据质量
- **网络信息**: 随机生成MAC地址、IP地址
- **设备型号**: 华为WATCH系列随机选择

### 运行监控
模拟器会每分钟显示统计信息：
- 健康数据上传成功/失败次数
- 设备信息上传成功/失败次数
- 活跃用户数量
- 部分用户的设备状态采样

### 停止模拟
按 `Ctrl+C` 停止模拟器

## 其他模式

### 快速测试模式
```bash
./utils/simulate_health_data.sh quick
```
生成2天的测试数据，适合功能验证。

### 批量模拟模式
```bash
./utils/simulate_health_data.sh batch
```
生成7天的历史数据，适合图表展示测试。

### 完整模拟模式
```bash
./utils/simulate_health_data.sh full
```
生成30天的完整数据，适合长期趋势分析。

## 前置条件

1. **大屏服务运行**: 确保 `ljwx-bigscreen` 服务在 `localhost:5001` 运行
2. **数据库连接**: 确保数据库连接正常，用户有有效的 `device_sn`
3. **Python依赖**: 安装 `requests` 和 `mysql-connector-python`

```bash
pip3 install requests mysql-connector-python
```

## API接口

模拟器使用以下API接口：
- **健康数据**: `POST http://localhost:5001/upload_health_data`
- **设备信息**: `POST http://localhost:5001/upload_device_info`

## 故障排除

### 常见问题
1. **无用户数据**: 检查数据库中 `sys_user` 表是否有 `org_id=1` 且 `device_sn` 不为空的用户
2. **连接失败**: 检查大屏服务是否运行在 `localhost:5001`
3. **数据库错误**: 检查 `DB_CONFIG` 中的数据库连接参数

### 调试模式
查看详细错误信息，可以直接运行Python脚本：
```bash
python3 utils/realtime_data_simulator.py
```

## 大屏验证建议

1. **启动顺序**: 先启动大屏服务，再启动模拟器
2. **观察时间**: 建议运行5-10分钟观察各种状态变化
3. **验证要点**: 
   - 数据实时更新
   - 图表数据变化
   - 告警状态触发
   - 设备状态变化 